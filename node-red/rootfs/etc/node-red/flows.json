[{"id":"12eb98f803d1e5b7","type":"tab","label":"Autodomo","disabled":false,"info":"","env":[]},{"id":"a9f10a0e46c23d35","type":"tab","label":"AutoDomo_DB","disabled":false,"info":"","env":[]},{"id":"bd155946fc3867cf","type":"tab","label":"MQTT_DB","disabled":false,"info":"","env":[]},{"id":"f879cf30d22aec46","type":"tab","label":"IR_AD","disabled":false,"info":"","env":[]},{"id":"5a2f87efbe0647a9","type":"tab","label":"IR_LIST","disabled":false,"info":"","env":[]},{"id":"e9473a462f630fe6","type":"tab","label":"Device_IR","disabled":false,"info":"","env":[]},{"id":"b3e227b45cdb32ea","type":"tab","label":"AutoDomo","disabled":false,"info":"","env":[]},{"id":"6a1bf79e0039b1d9","type":"tab","label":"Mash","disabled":false,"info":"","env":[]},{"id":"45bd2399da8caa2f","type":"tab","label":"Startup","disabled":false,"info":""},{"id":"ec3b45f2cddba51a","type":"firebase config","firebaseurl":"autodomo-73076","loginType":"none"},{"id":"7da491b7.5ebd7","type":"server","name":"Home Assistant","addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"","connectionDelay":false,"cacheJson":false,"heartbeat":false,"heartbeatInterval":"","statusSeparator":"","enableGlobalContextStore":false},{"id":"fe4e38f1ebf658ab","type":"ui-group","name":"group_ir","page":"231d77f5b345360c","width":"6","height":"5","order":1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"7efae0353730d6d1","type":"ui-group","name":"groupconec","page":"44c9cc56ddd6aa6d","width":"6","height":"1","order":1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"46d3afc1dc57ad44","type":"ui-group","name":"conmqtt","page":"9ab477617917fe67","width":"6","height":"1","order":2,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"e7d321c1a08767ba","type":"ui-group","name":"Teste MQTT","page":"9ab477617917fe67","width":"6","height":"1","order":3,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"5ad88dda6fe98f33","type":"ui-group","name":"salvarir_group","page":"231d77f5b345360c","width":"6","height":"1","order":2,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"06378199283358d5","type":"ui-group","name":"busca_ir","page":"aad01bbc5425f17b","width":"11","height":"1","order":2,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"f1151d10cc234b8a","type":"ui-group","name":"Salvar_ir_group_ex","page":"231d77f5b345360c","width":"6","height":"1","order":3,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"3ebd4505c5a6d063","type":"ui-group","name":"testemqtt_ouvir","page":"9ab477617917fe67","width":"6","height":"3","order":4,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"d23d8ea27aca7163","type":"ui-group","name":"qrcode_group","page":"44c9cc56ddd6aa6d","width":"6","height":"1","order":2,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"da680eea7fc73142","type":"ui-group","name":"add_tv","page":"0f47a0e7bedfb53e","width":"6","height":"1","order":-1,"showTitle":false,"className":"","visible":"false","disabled":"false"},{"id":"fd9db4515147f459","type":"ui-group","name":"add_arcon","page":"0f47a0e7bedfb53e","width":"6","height":"1","order":-1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"7866a0a062b724fe","type":"ui-group","name":"device_list","page":"5ccdbdf523abb93b","width":"12","height":"1","order":1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"9ab477617917fe67","type":"ui-page","name":"MQTT","ui":"17f0c29053c20d2e","path":"/conec","icon":"cog","layout":"grid","theme":"dcae3755f64143ac","order":2,"className":"","visible":"true","disabled":"false"},{"id":"231d77f5b345360c","type":"ui-page","name":"Ir Code ADD","ui":"17f0c29053c20d2e","path":"/ir","icon":"remote-tv","layout":"grid","theme":"dcae3755f64143ac","order":5,"className":"","visible":"true","disabled":"false"},{"id":"aad01bbc5425f17b","type":"ui-page","name":"Ir Code List","ui":"17f0c29053c20d2e","path":"/irlist","icon":"remote-tv-off","layout":"grid","theme":"dcae3755f64143ac","order":6,"className":"","visible":"true","disabled":"false"},{"id":"44c9cc56ddd6aa6d","type":"ui-page","name":"App","ui":"17f0c29053c20d2e","path":"/adomo","icon":"apps","layout":"grid","theme":"dcae3755f64143ac","order":1,"className":"","visible":"true","disabled":"false"},{"id":"5ccdbdf523abb93b","type":"ui-page","name":"Device_List","ui":"17f0c29053c20d2e","path":"/devicelist","icon":"mdi-playlist-play","layout":"grid","theme":"dcae3755f64143ac","order":4,"className":"","visible":"true","disabled":"false"},{"id":"0f47a0e7bedfb53e","type":"ui-page","name":"Device Add ","ui":"17f0c29053c20d2e","path":"/dev_add","icon":"mdi-devices","layout":"grid","theme":"dcae3755f64143ac","order":3,"className":"","visible":"true","disabled":"false"},{"id":"dcae3755f64143ac","type":"ui-theme","name":"Default Theme","colors":{"surface":"#ffffff","primary":"#0094ce","bgPage":"#ffffff","groupBg":"#ffffff","groupOutline":"#cccccc"},"sizes":{"pagePadding":"12px","groupGap":"12px","groupBorderRadius":"4px","widgetGap":"12px"}},{"id":"17f0c29053c20d2e","type":"ui-base","name":"AutoDomo","path":"/dashboard","includeClientData":true,"acceptsClientConfig":["ui-notification","ui-control"],"showPathInSidebar":false,"navigationStyle":"default"},{"id":"9a93dc0a78c5b00b","type":"sqlitedb","db":"/homeassistant/autodomo.db","mode":"RWC"},{"id":"29636dffefc2a433","type":"ui-group","name":"limpar_dispositivo","page":"5ccdbdf523abb93b","width":"12","height":"1","order":2,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"28f04da4deccc856","type":"ui-page","name":"Autodomo","ui":"17f0c29053c20d2e","path":"/autodomo","icon":"home-floor-a","layout":"notebook","theme":"dcae3755f64143ac","order":-1,"className":"","visible":"true","disabled":"false"},{"id":"a611c7323a50204f","type":"ui-group","name":"apresentacao","page":"28f04da4deccc856","width":"6","height":"1","order":-1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"d751252f986b7490","type":"ui-group","name":"appstore","page":"28f04da4deccc856","width":"6","height":"1","order":-1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"b3022d25ccf238fe","type":"ui-group","name":"money","page":"28f04da4deccc856","width":"6","height":"1","order":-1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"40a447a2b4542eb4","type":"ui-group","name":"token","page":"28f04da4deccc856","width":"12","height":"1","order":-1,"showTitle":false,"className":"","visible":"true","disabled":"false"},{"id":"4097e6b7f8852572","type":"ui-template","z":"12eb98f803d1e5b7","group":"a611c7323a50204f","page":"","ui":"","name":"Apresentação","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <div>\n    <v-hover v-slot=\"{ isHovering, props }\">\n      <v-card\n        class=\"mx-auto\"\n        color=\"grey-lighten-4\"\n        max-width=\"900\"\n        v-bind=\"props\"\n      >\n        <v-img\n          :aspect-ratio=\"16/9\"\n          src=\"https://eastwood.co.ke/wp-content/uploads/2021/03/Smart-home.jpg\"\n          cover\n        >\n          <v-expand-transition>\n            <div\n              v-if=\"isHovering\"\n              class=\"d-flex transition-fast-in-fast-out bg-blue-darken-2 v-card--reveal text-h2\"\n              style=\"height: 100%;\"\n            >\n              AutoDomo\n            </div>\n          </v-expand-transition>\n        </v-img>\n\n        <v-card-text class=\"pt-6\">\n          <div class=\"font-weight-light text-grey text-h6 mb-2\">\n            AutoDomo Simples assim\n          </div>\n\n          <h3 class=\"text-h4 font-weight-light text-blue mb-2\">\n            AutoDomo\n          </h3>\n\n        <div class=\"font-weight-light text-h6 mb-2\">\n          O Add-ons AutoDomo permite que você possa conectar o seu Home Assitant ao seu aplicativo autodomo.\n        </div>\n\n          <div class=\"font-weight-light text-h7 mb-2\">\n            <ul>\n                <li>Controle de Multiplas Residências</li>\n                <li>Sicronização nativa com Alexa</li>\n                <li>Configuração facilidade de dispositivos infravermelho</li>\n                <li>Gerenciamento facilitados dos códigos infravermelho</li>\n                <li>Suporte para Android e IOS</li>\n            </ul>\n        </div>\n\n        </v-card-text>\n      </v-card>\n    </v-hover>\n\n      \n  </div>\n</template>\n<style>\n  .v-card--reveal {\n    align-items: center;\n    bottom: 0;\n    justify-content: center;\n    opacity: .05;\n    position: absolute;\n    width: 100%;\n  }\n</style>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":400,"y":200,"wires":[[]]},{"id":"7cb4af0e37b133c3","type":"ui-template","z":"12eb98f803d1e5b7","group":"d751252f986b7490","page":"","ui":"","name":"AppStore","order":0,"width":0,"height":0,"head":"","format":"<template>\n\n\n  <h3 class=\"text-h4 font-weight-light text-blue mb-2\">\n    Primeira vez usando o AutoDomo.\n  </h3>\n\n    <div class=\"font-weight-light text-h7 mb-2\">\n      <ul>\n        <li>Escaneie o código com sua câmera para acessar a loja de aplicativos e baixe o app.</li>\n        <li><a href=\"http://app.autodomo.com.br\" target=\"_blank\">Link para o token app.autodomo.com.br</a></li>\n        <li>Siga os passos de cadastro da senha eletrônica, usada só pra acessar o sistema.</li>\n        <li>Siga os passos de cadastro do Token; só com ele você poderá controlar os dispositivos.</li>\n        <li>Prontinho! Você já pode utilizar o app AutoDomo para controlar seus dispositivos.</li>\n      </ul>\n    </div>\n\n\n  <v-container fluid>\n    <v-row dense>\n      <v-col v-for=\"card in cards\" :key=\"card.title\" :cols=\"card.flex\">\n        <v-img\n          :src=\"card.src\"\n          gradient=\"to bottom, rgba(0,0,0,0.05), rgba(0,0,0,0.05)\"\n          height=\"300px\"\n          contain\n        >\n          <v-row class=\"fill-height align-end\">\n            <v-col>\n              <v-card-title\n                class=\"text-white\"\n                v-text=\"card.title\"\n              ></v-card-title>\n            </v-col>\n          </v-row>\n        </v-img>\n      </v-col>\n    </v-row>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    cards: [\n      {\n        title: '',\n        src: 'https://autodomo.com.br/images/applestore.png',\n        flex: 6,\n      },\n      {\n        title: '',\n        src: 'https://autodomo.com.br/images/googleplay2.png',\n        flex: 6,\n      },\n    ],\n  }),\n}\n</script>\n\n\n\n\n196\n269\n","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":400,"y":260,"wires":[[]]},{"id":"c6e45eab21bb309f","type":"ui-template","z":"12eb98f803d1e5b7","group":"b3022d25ccf238fe","page":"","ui":"","name":"AppStore","order":0,"width":0,"height":0,"head":"","format":"<template>\n\n\n\n <div>\n        <h1 style=\"text-align: center;\">🏡💡 <strong>Ajude a Aperfeiçoar o AutoDomo!</strong> 💡🏡</h1>\n        <p></p><br>\n        <p>Olá, amantes da automação residencial!</p>\n        <p>Na busca contínua por tornar a automação de sua casa ainda mais inteligente e eficiente, estamos sempre empenhados em aprimorar o AutoDomo, e para isso, precisamos do seu apoio!</p>\n        <p>Se o AutoDomo já facilitou sua vida ao controlar as luzes, termostatos, câmeras e muito mais, ou se você tem sugestões para deixá-lo ainda mais incrível, considere contribuir conosco. Cada pequena contribuição faz uma grande diferença em nosso esforço contínuo para oferecer a melhor experiência possível.</p>\n        <p>Sua contribuição será diretamente investida no desenvolvimento de novos recursos, melhorias de desempenho e na garantia de que o AutoDomo continue sendo uma ferramenta indispensável para tornar sua casa mais inteligente e confortável.</p>\n        <p>Contribuir é simples e seguro. Basta clicar no link abaixo e escolher o valor que deseja doar. Todo apoio é imensamente apreciado e nos ajuda a manter o AutoDomo no caminho certo.</p>\n        <p>Agradecemos sinceramente por fazer parte da comunidade AutoDomo e por ajudar a moldar o futuro da automação residencial.</p>\n        <p>Com gratidão,</p>\n        <p>Equipe AutoDomo</p>\n        <p>\n                <form action=\"https://www.paypal.com/donate\" method=\"post\" target=\"_top\">\n                  <input type=\"hidden\" name=\"business\" value=\"A7LJZ2W82R8NQ\" />\n                  <input type=\"hidden\" name=\"no_recurring\" value=\"0\" />\n                  <input type=\"hidden\" name=\"item_name\" value=\"Ajude a Manter a Equipe AutoDomo\" />\n                  <input type=\"hidden\" name=\"currency_code\" value=\"BRL\" />\n                  <input type=\"image\" src=\"https://www.paypalobjects.com/pt_BR/BR/i/btn/btn_donateCC_LG.gif\" border=\"0\" name=\"submit\" title=\"PayPal - The safer, easier way to pay online!\" alt=\"Faça doações com o botão do PayPal\" />\n                  <img alt=\"\" border=\"0\" src=\"https://www.paypal.com/pt_BR/i/scr/pixel.gif\" width=\"1\" height=\"1\" />\n                </form>\n        </p>\n    </div>\n\n  <v-container fluid>\n    <v-row dense>\n      <v-col v-for=\"card in cards\" :key=\"card.title\" :cols=\"card.flex\">\n        <v-img\n          :src=\"card.src\"\n          gradient=\"to bottom, rgba(0,0,0,0), rgba(0,0,0,0.05)\"\n          height=\"400px\"\n          contain\n        >\n          <v-row class=\"fill-height align-end\">\n            <v-col>\n              <v-card-title\n                class=\"text-white\"\n                style=\"text-align: center;\"\n                v-text=\"card.title\"\n              ></v-card-title>\n            </v-col>\n          </v-row>\n        </v-img>\n      </v-col>\n \n    </v-row>\n  </v-container>\n</template>\n\n<script>\nexport default {\n  data: () => ({\n    cards: [\n      {\n        title: '',\n        src: 'https://autodomo.com.br/images/qrcode-pix.png',\n        flex: 6,\n      },\n       {\n        title: '',\n        src: 'https://autodomo.com.br/images/QRCode_paypal.png',\n        flex: 6,\n      }\n    ],\n  }),\n}\n</script>\n\n\n\n\n196\n269\n","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":400,"y":320,"wires":[[]]},{"id":"199f1f51cb0e69a5","type":"ui-template","z":"12eb98f803d1e5b7","d":true,"group":"40a447a2b4542eb4","page":"","ui":"","name":"token","order":0,"width":"12","height":"2","head":"","format":"<template>\n\n  <v-sheet class=\"mx-auto\" width=\"900\">\n    <v-form validate-on=\"submit lazy\" @submit.prevent=\"submit\">\n      <v-text-field\n        v-model=\"userName\"\n        :rules=\"rules\"\n        label=\"E-mail\"\n      ></v-text-field>\n\n      <v-btn\n        :loading=\"loading\"\n        class=\"mt-2\"\n        text=\"Solicitar Token\"\n        type=\"submit\"\n        block\n      ></v-btn>\n    </v-form>\n  </v-sheet>\n</template>\n<script>\n  export default {\n    data: vm => ({\n      loading: false,\n      rules: [value => vm.checkApi(value)],\n      timeout: null,\n      userName: '',\n    }),\n\n    methods: {\n      async submit (event) {\n        this.loading = true\n\n        const results = await event\n\n        this.loading = false\n\n        alert(JSON.stringify(results.errors[0].errorMessages[0], null, 2))\n      },\n      async checkApi (userName) {\n        return new Promise(resolve => {\n          clearTimeout(this.timeout)\n\n          this.timeout = setTimeout(() => {\n            if (/^[a-z.-]+@[a-z.-]+\\.[a-z]+$/i.test(userName)) {\n              this.send({ payload : userName});\n              global.set(\"solicitado_token\", 1);\n              let solicitado_token = 0\n\n                while(true){\n\n                solicitado_token = global.get(\"solicitado_token\");\n\n                    if(solicitado_token == \"ok\"){\n\n                      return resolve(\"Token Solicitado com Sucesso, Verifique seu e-mail\");\n\n                    }else if(solicitado_token == \"error\"){\n\n                      return resolve(\"Erro ao solicita seu token, verifique seu e-mail e tente novamente\");\n\n                    }\n\n                }\n\n              }\n\n  \n\n\n            if (!userName) return resolve('Porfavor entre com o seu e-mail.')\n\n            return resolve(\"Entre com um e-mail Válido\")\n          }, 4000)\n        })\n      },\n    },\n  }\n</script>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":390,"y":360,"wires":[["cbe311758afd5b1a"]]},{"id":"cbe311758afd5b1a","type":"debug","z":"12eb98f803d1e5b7","d":true,"name":"debug 37","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":580,"y":380,"wires":[]},{"id":"c67d6905f81b6f18","type":"inject","z":"12eb98f803d1e5b7","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":380,"wires":[["199f1f51cb0e69a5"]]},{"id":"d942631cad74a7e7","type":"function","z":"a9f10a0e46c23d35","name":"function 30","func":"const name_ad  = msg.payload;\nglobal.set(\"name_ad_temp\", name_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":120,"wires":[[]]},{"id":"a179c0859b65b4df","type":"function","z":"a9f10a0e46c23d35","name":"function 31","func":"const ip_ad  = msg.payload;\nglobal.set(\"ip_ad_temp\", ip_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":160,"wires":[[]]},{"id":"5345a74a517889e9","type":"function","z":"a9f10a0e46c23d35","name":"function 32","func":"const hash_ad  = msg.payload;\nglobal.set(\"hash_ad_temp\", hash_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":200,"wires":[[]]},{"id":"fae145037a0619c5","type":"function","z":"a9f10a0e46c23d35","name":"function 33","func":"const token_api_ad  = msg.payload;\nglobal.set(\"token_api_ad_temp\", token_api_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":240,"wires":[[]]},{"id":"e87017dba3509833","type":"function","z":"a9f10a0e46c23d35","name":"function 34","func":"const hash_ad = global.get(\"hash_ad\") || \"\";\n\nmsg.payload = hash_ad;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":200,"wires":[["4dc4c793382ae519"]]},{"id":"8cce643693247c9d","type":"function","z":"a9f10a0e46c23d35","name":"function 35","func":"const token_api_ad = global.get(\"token_api_ad\");\n\nmsg.payload = token_api_ad\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":240,"wires":[["4feffa7f22207344"]]},{"id":"e7b386493fc4717c","type":"inject","z":"a9f10a0e46c23d35","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"2","topic":"","payload":"","payloadType":"date","x":120,"y":180,"wires":[["8cce643693247c9d","e87017dba3509833","e9ba03a6a7b61f4c","501afd3e7386b14a","d6b98070d52724da"]]},{"id":"e9ba03a6a7b61f4c","type":"function","z":"a9f10a0e46c23d35","name":"function 36","func":"const ip_ad = global.get(\"ip_ad\") || \"\";\n\nmsg.payload = ip_ad;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":160,"wires":[["f0f0572ebf7ae3c1"]]},{"id":"501afd3e7386b14a","type":"function","z":"a9f10a0e46c23d35","name":"function 37","func":"const name_ad = global.get(\"name_ad\") || \"\";\n\nmsg.payload = name_ad;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":120,"wires":[["86468730548013ec"]]},{"id":"1d7428a471795069","type":"function","z":"a9f10a0e46c23d35","name":"function 38","func":"const comando = msg.payload;\n\nvar msg1 = null;\nmsg1 = Object.assign({}, msg);\n\nif(comando == \"limparcon1\"){\n    msg.payload = \"\";\n    return [msg, null];\n}else if(comando == \"savecon1\"){\n\n    const name_ad = global.get(\"name_ad_temp\") || \"\";\n    const ip_ad = global.get(\"ip_ad_temp\") || \"\";\n    const hash_ad = global.get(\"hash_ad_temp\") || \"\";\n    const token_api_ad = global.get(\"token_api_ad_temp\");\n\n    global.set(\"name_ad\", name_ad);\n    global.set(\"ip_ad\", ip_ad);\n    global.set(\"hash_ad\", hash_ad);\n    global.set(\"token_api_ad\", token_api_ad);\n\n    msg.topic = `INSERT INTO config (id, hash_ad, ip_ad, name_ad, token_api_ad, ir_simplified_ad) VALUES (1, '${hash_ad}', '${ip_ad}', '${name_ad}', '${token_api_ad}', '1') ON CONFLICT(id) DO UPDATE SET hash_ad = excluded.hash_ad, ip_ad = excluded.ip_ad, name_ad = excluded.name_ad,token_api_ad = excluded.token_api_ad, ir_simplified_ad = excluded.ir_simplified_ad;`\n\n    return [null, msg]; \n}\n\nreturn null;","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":280,"wires":[["86468730548013ec","f0f0572ebf7ae3c1","4dc4c793382ae519","4feffa7f22207344"],["9e080f142632f343"]]},{"id":"d6b98070d52724da","type":"function","z":"a9f10a0e46c23d35","name":"function 68","func":"const qrcode_ad = global.get(\"qrcode_ad\");\n\nmsg.payload = qrcode_ad\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":420,"wires":[["43b0f5f4ccd33ebb"]]},{"id":"4feffa7f22207344","type":"ui-text-input","z":"a9f10a0e46c23d35","group":"7efae0353730d6d1","name":"Token Api Home Assistant","label":"Token Api Home Assistant","order":5,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"password","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":550,"y":240,"wires":[["fae145037a0619c5"]]},{"id":"4dc4c793382ae519","type":"ui-text-input","z":"a9f10a0e46c23d35","group":"7efae0353730d6d1","name":"Hash AutoDomo","label":"Hash AutoDomo","order":4,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"password","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":520,"y":200,"wires":[["5345a74a517889e9"]]},{"id":"f0f0572ebf7ae3c1","type":"ui-text-input","z":"a9f10a0e46c23d35","group":"7efae0353730d6d1","name":"IP Home Assistant","label":"IP Home Assistant","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":530,"y":160,"wires":[["a179c0859b65b4df"]]},{"id":"86468730548013ec","type":"ui-text-input","z":"a9f10a0e46c23d35","group":"7efae0353730d6d1","name":"Nome Dispositivo","label":"Nome Dispositivo","order":2,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":530,"y":120,"wires":[["d942631cad74a7e7"]]},{"id":"254c9631abc3c013","type":"ui-text","z":"a9f10a0e46c23d35","group":"7efae0353730d6d1","order":1,"width":0,"height":0,"name":"Dados Conexão Autodomo/Home Assistant","label":"Dados Conexão Autodomo/Home Assistant","format":"{{msg.payload}}","layout":"row-center","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":610,"y":80,"wires":[]},{"id":"bf81e59db687579c","type":"ui-template","z":"a9f10a0e46c23d35","group":"7efae0353730d6d1","page":"","ui":"","name":"","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <v-container>\n    <v-row align=\"center\" justify=\"center\">\n        \n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" @click=\"send({payload: 'savecon1'})\">\n        <v-icon icon=\"mdi-content-save-outline\" start>\n        </v-icon>\n           Salvar\n        </v-btn>\n        \n      </v-col>\n\n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" color=\"red\" @click=\"send({payload: 'limparcon1'})\">\n        <v-icon icon=\"mdi-delete-circle-outline\" start>\n        </v-icon>\n            Limpar\n        </v-btn>\n\n      </v-col>\n\n    </v-row>\n  </v-container>\n</template>\n\n\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":160,"y":280,"wires":[["1d7428a471795069"]]},{"id":"43b0f5f4ccd33ebb","type":"ui-template","z":"a9f10a0e46c23d35","group":"d23d8ea27aca7163","page":"","ui":"","name":"","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <div class=\"d-flex justify-space-around align-center bg-grey-lighten-4\">\n    <div class=\"ma-4\">\n\n      <v-img :aspect-ratio=\"1\" class=\"bg-white\" :src=\"base64Image\" width=\"300\"></v-img>\n\n  </div>\n</template>\n\n<script>\n  export default {\n  data() {\n    return {\n      base64Image: '' // Inicialmente vazio, será preenchido com a imagem base64\n    };\n  },\n  mounted() {\n    // Se sua mensagem já contém a imagem em base64, você pode atribuí-la diretamente aqui\n    this.base64Image =  this.msg.payload;\n  }\n};\n</script>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":520,"y":420,"wires":[[]]},{"id":"9e080f142632f343","type":"sqlite","z":"a9f10a0e46c23d35","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":560,"y":300,"wires":[[]]},{"id":"c4a6257e2ca1b5ef","type":"function","z":"bd155946fc3867cf","name":"function 8","func":"const topico  = msg.payload;\nglobal.set(\"topic_teste_pub\", topico);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":440,"wires":[[]]},{"id":"cdf7eabc460484d0","type":"function","z":"bd155946fc3867cf","name":"function 9","func":"const mensagem  = msg.payload;\nglobal.set(\"mensagem_teste_pub\", mensagem);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":480,"wires":[[]]},{"id":"25079c53b4956c88","type":"function","z":"bd155946fc3867cf","name":"function 10","func":"const topico  = global.get(\"topic_teste_pub\");\nconst mensagem  = global.get(\"mensagem_teste_pub\");\n\nconst client_id  = \"100008\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\nmsg.topic = topico;\nmsg.payload = mensagem;\n\nreturn msg","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":520,"wires":[["2657dcd5037bc261"]]},{"id":"193768c79989e37e","type":"function","z":"bd155946fc3867cf","name":"function 11","func":" const liberar_teste_pub  = msg.payload;\n const client_id  = \"100008\";\n const topico = global.get(\"topic_teste_sub\");\n\nif (liberar_teste_pub){\n\n     \n     \n     const host = global.get(\"mqtt_broker_ad\") || \"\";\n     const port = global.get(\"mqtt_porta\") || \"\";\n     const username = global.get(\"mqtt_usuario_ad\") || \"\";\n     const password = global.get(\"mqtt_senha_ad\") || \"\";\n\n     msg.command = \"__add_broker\";\n     msg.brokerId = client_id,\n     msg.payload = {\n          subscriptions: [topico],\n          options: {\n               protocol:  'mqtt',\n               port,\n               host,\n               \"clientId\" : client_id,\n               username,\n               password\n          }\n     }\n\n     msg.cmd = 'subscribe';\n     return msg;\n\n     \n \n     \n}else{\n\n     msg.command = \"__remove_broker\";\n     msg.brokerId = client_id,\n     msg.payload = {\n      subscriptions: [topico],\n     }\n     msg.cmd = 'subscribe';\n     flow.set(\"mensagem\", \"\");\n     return msg;\n}\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":270,"y":640,"wires":[["b6ac61f2b8ad565b"]]},{"id":"d7221e6c7b326f04","type":"function","z":"bd155946fc3867cf","name":"function 14","func":"const topico  = msg.payload;\nglobal.set(\"topic_teste_sub\", topico);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":560,"wires":[[]]},{"id":"0ec1d4af9ab3d589","type":"function","z":"bd155946fc3867cf","name":"function 15","func":"const topico = global.get(\"topic_teste_sub\");\n//if (msg.brokerId !=  \"100008\") return;\nif (msg.topic !=  topico) return;\n\nlet mensagem =  flow.get(\"mensagem\") || \"\";\n\nconst timestamp = new Date().toISOString();\n\nmensagem = mensagem + `${timestamp}  --  ${msg.payload}\\n`;\n\n\nmsg.payload = mensagem;\nflow.set(\"mensagem\", mensagem);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":640,"wires":[["e708e1e4787595ce"]]},{"id":"c5db50a0f5c68c90","type":"function","z":"bd155946fc3867cf","name":"function 16","func":"const habilitado = msg.payload;\n\nif(!habilitado){\n\n    msg.payload = {\n        groups: {\n            enable: ['MQTT:testemqtt_ouvir']\n        }\n    }\n\n\n}else{\n\n    msg.payload = {\n        groups: {\n            disable: ['MQTT:testemqtt_ouvir']\n        }\n\n    }\n\n}\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":700,"wires":[["767459c03286b43f"]]},{"id":"066a8c4de9f90f9e","type":"function","z":"bd155946fc3867cf","name":"function 39","func":"const mqtt_broker_ad = global.get(\"mqtt_broker_ad\") || \"\";\n\nmsg.payload = mqtt_broker_ad;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":80,"wires":[["987d29b97bcf6ebb"]]},{"id":"779b1daf1a4113a2","type":"function","z":"bd155946fc3867cf","name":"function 40","func":"const mqtt_porta = global.get(\"mqtt_porta\") || \"\";\n\nmsg.payload = Number(mqtt_porta) || 0;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":120,"wires":[["fdcc2093baa13557"]]},{"id":"0f5d078549e866e9","type":"function","z":"bd155946fc3867cf","name":"function 41","func":"const mqtt_usuario_ad = global.get(\"mqtt_usuario_ad\") || \"\";\n\nmsg.payload = mqtt_usuario_ad;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":160,"wires":[["d3e82bfe36d3f0ae"]]},{"id":"a86a029ac05a7117","type":"function","z":"bd155946fc3867cf","name":"function 42","func":"const mqtt_senha_ad = global.get(\"mqtt_senha_ad\") || \"\";\n\nmsg.payload = mqtt_senha_ad;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":200,"wires":[["223203c1581578a1"]]},{"id":"308f700a76e35656","type":"function","z":"bd155946fc3867cf","name":"function 43","func":"const comando = msg.payload;\n\nvar msg1 = null;\nmsg1 = Object.assign({}, msg);\n\nif(comando == \"limparcon1\"){\n    msg.payload = \"\";\n    return [msg, null];\n}else if(comando == \"savecon1\"){\n\n    const mqtt_broker_ad = global.get(\"mqtt_broker_ad_temp\") || \"\";\n    const mqtt_porta = global.get(\"mqtt_porta_ad_temp\") || \"\";\n    const mqtt_usuario_ad = global.get(\"mqtt_usuario_ad_temp\") || \"\";\n    const mqtt_senha_ad = global.get(\"mqtt_senha_ad_temp\");\n    const mqtt_senha_ad_enc = global.get(\"mqtt_senha_ad_temp_enc\");\n\n\n    global.set(\"mqtt_broker_ad\", mqtt_broker_ad);\n    global.set(\"mqtt_porta\", mqtt_porta);\n    global.set(\"mqtt_usuario_ad\", mqtt_usuario_ad);\n    global.set(\"mqtt_senha_ad\", mqtt_senha_ad);\n    global.set(\"mqtt_senha_ad_enc\", mqtt_senha_ad_enc);\n\n    global.set(\"modificado_mqtt_1\", \"1\");\n    global.set(\"modificado_mqtt_2\", \"1\");\n    global.set(\"modificado_mqtt_3\", \"1\");\n\n\n    msg.topic = `INSERT INTO mqttconfig (id, mqtt_broker_ad, mqtt_porta, mqtt_usuario_ad, mqtt_senha_ad, mqtt_senha_ad_cripto) VALUES (1, '${mqtt_broker_ad}', '${mqtt_porta}', '${mqtt_usuario_ad}', '${mqtt_senha_ad}', '${mqtt_senha_ad_enc}') ON CONFLICT(id) DO UPDATE SET mqtt_broker_ad = excluded.mqtt_broker_ad, mqtt_porta = excluded.mqtt_porta, mqtt_usuario_ad = excluded.mqtt_usuario_ad, mqtt_senha_ad = excluded.mqtt_senha_ad, mqtt_senha_ad_cripto = excluded.mqtt_senha_ad_cripto;`\n\n    return [null, msg]; \n}\n\nreturn null;","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":240,"wires":[["223203c1581578a1","d3e82bfe36d3f0ae","fdcc2093baa13557","987d29b97bcf6ebb"],["79576dbb92103543","61f1f5fcdf165042"]]},{"id":"02552809ed5e69eb","type":"inject","z":"bd155946fc3867cf","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"2","topic":"","payload":"","payloadType":"date","x":140,"y":140,"wires":[["066a8c4de9f90f9e","779b1daf1a4113a2","0f5d078549e866e9","a86a029ac05a7117"]]},{"id":"83ecd3060b45f706","type":"function","z":"bd155946fc3867cf","name":"function 44","func":"const mqtt_broker_ad  = msg.payload;\nglobal.set(\"mqtt_broker_ad_temp\", mqtt_broker_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":80,"wires":[[]]},{"id":"ef8c54c15c038d4c","type":"function","z":"bd155946fc3867cf","name":"function 45","func":"const mqtt_porta_ad  = msg.payload;\nglobal.set(\"mqtt_porta_ad_temp\", mqtt_porta_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":120,"wires":[[]]},{"id":"d40c78bd38ef7b46","type":"function","z":"bd155946fc3867cf","name":"function 46","func":"const mqtt_usuario_ad  = msg.payload;\nglobal.set(\"mqtt_usuario_ad_temp\", mqtt_usuario_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":160,"wires":[[]]},{"id":"b851148c2b718447","type":"function","z":"bd155946fc3867cf","name":"function 47","func":"const mqtt_senha_ad  = msg.payload;\nglobal.set(\"mqtt_senha_ad_temp\", mqtt_senha_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":200,"wires":[[]]},{"id":"d8220393e3a0090e","type":"function","z":"bd155946fc3867cf","name":"function 48","func":"const mqtt_senha_ad_enc  = msg.payload;\nglobal.set(\"mqtt_senha_ad_temp_enc\", mqtt_senha_ad_enc);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":240,"wires":[[]]},{"id":"987d29b97bcf6ebb","type":"ui-text-input","z":"bd155946fc3867cf","group":"46d3afc1dc57ad44","name":"Servidor Broker","label":"Servidor Broker","order":2,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":540,"y":80,"wires":[["83ecd3060b45f706"]]},{"id":"fdcc2093baa13557","type":"ui-text-input","z":"bd155946fc3867cf","group":"46d3afc1dc57ad44","name":"Porta Broker","label":"Porta Broker","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"number","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":530,"y":120,"wires":[["ef8c54c15c038d4c"]]},{"id":"d3e82bfe36d3f0ae","type":"ui-text-input","z":"bd155946fc3867cf","group":"46d3afc1dc57ad44","name":"Usuario MQTT","label":"Usuario MQTT","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":540,"y":160,"wires":[["d40c78bd38ef7b46"]]},{"id":"223203c1581578a1","type":"ui-text-input","z":"bd155946fc3867cf","group":"46d3afc1dc57ad44","name":"Password","label":"Password","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"password","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":520,"y":200,"wires":[["a388c289f3124910","b851148c2b718447"]]},{"id":"bc7ae6f0221072f7","type":"ui-text-input","z":"bd155946fc3867cf","group":"e7d321c1a08767ba","name":"Topico Publicar","label":"Topico Publicar","order":2,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":140,"y":440,"wires":[["c4a6257e2ca1b5ef"]]},{"id":"bf07e1cca7fe2426","type":"ui-text-input","z":"bd155946fc3867cf","group":"e7d321c1a08767ba","name":"Mensagem Publicar","label":"Mensagem Publicar","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":160,"y":480,"wires":[["cdf7eabc460484d0"]]},{"id":"74239de6b9850d4b","type":"ui-text-input","z":"bd155946fc3867cf","group":"3ebd4505c5a6d063","name":"Topico Subscrever","label":"Topico Subscrever","order":5,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":150,"y":560,"wires":[["d7221e6c7b326f04"]]},{"id":"e708e1e4787595ce","type":"ui-text-input","z":"bd155946fc3867cf","group":"3ebd4505c5a6d063","name":"Mensagem Subscrever","label":"Mensagem Subscrever","order":6,"width":"0","height":"0","topic":"payload","topicType":"msg","mode":"textarea","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":false,"className":"","x":890,"y":640,"wires":[[]]},{"id":"340b4542aea2f617","type":"ui-button","z":"bd155946fc3867cf","group":"e7d321c1a08767ba","name":"","label":"Publicar","order":4,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"enviar","payloadType":"str","topic":"topic","topicType":"msg","x":120,"y":520,"wires":[["25079c53b4956c88"]]},{"id":"5493af1074b92748","type":"ui-switch","z":"bd155946fc3867cf","name":"","label":"Subscrever","group":"e7d321c1a08767ba","order":0,"width":0,"height":0,"passthru":false,"topic":"topic","topicType":"msg","style":"","className":"","onvalue":"true","onvalueType":"bool","onicon":"mdi-network","oncolor":"green","offvalue":"false","offvalueType":"bool","officon":"mdi-network","offcolor":"red","x":90,"y":640,"wires":[["193768c79989e37e","c5db50a0f5c68c90"]]},{"id":"2713327d97c850f2","type":"ui-text","z":"bd155946fc3867cf","group":"46d3afc1dc57ad44","order":1,"width":0,"height":0,"name":"Dados MQTT","label":"Dados MQTT","format":"{{msg.payload}}","layout":"row-center","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":540,"y":40,"wires":[]},{"id":"fdb6ad13fe7326e8","type":"ui-text","z":"bd155946fc3867cf","group":"e7d321c1a08767ba","order":1,"width":0,"height":0,"name":"Teste MQTT","label":"Teste MQTT","format":"{{msg.payload}}","layout":"row-center","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":130,"y":400,"wires":[]},{"id":"5464af7a08097558","type":"ui-template","z":"bd155946fc3867cf","group":"46d3afc1dc57ad44","page":"","ui":"","name":"","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <v-container>\n    <v-row align=\"center\" justify=\"center\">\n        \n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" @click=\"send({payload: 'savecon1'})\">\n        <v-icon icon=\"mdi-content-save-outline\" start>\n        </v-icon>\n           Salvar\n        </v-btn>\n        \n      </v-col>\n\n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" color=\"red\" @click=\"send({payload: 'limparcon1'})\">\n        <v-icon icon=\"mdi-delete-circle-outline\" start>\n        </v-icon>\n            Limpar\n        </v-btn>\n\n      </v-col>\n\n    </v-row>\n  </v-container>\n</template>\n\n\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":160,"y":240,"wires":[["308f700a76e35656"]]},{"id":"767459c03286b43f","type":"ui-control","z":"bd155946fc3867cf","name":"","ui":"17f0c29053c20d2e","events":"all","x":500,"y":700,"wires":[[]]},{"id":"79576dbb92103543","type":"sqlite","z":"bd155946fc3867cf","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":560,"y":240,"wires":[[]]},{"id":"a388c289f3124910","type":"bcrypt","z":"bd155946fc3867cf","name":"","action":"encrypt","field":"payload","hash":"payload","target":"payload","assignment":"replace","match":"match","outputs":1,"rounds":10,"x":730,"y":240,"wires":[["d8220393e3a0090e"]]},{"id":"b6ac61f2b8ad565b","type":"mqtt one","z":"bd155946fc3867cf","name":"","x":470,"y":640,"wires":[["0ec1d4af9ab3d589"]]},{"id":"1c5e538b527888ab","type":"ui-switch","z":"bd155946fc3867cf","name":"","label":"MQTT Status","group":"46d3afc1dc57ad44","order":0,"width":0,"height":0,"passthru":false,"topic":"topic","topicType":"msg","style":"","className":"","onvalue":"true","onvalueType":"bool","onicon":"mdi-network","oncolor":"green","offvalue":"false","offvalueType":"bool","officon":"mdi-network","offcolor":"red","x":1370,"y":320,"wires":[[]]},{"id":"f75252c1dcdbab4a","type":"mqtt one","z":"bd155946fc3867cf","name":"","x":850,"y":340,"wires":[["a58995f11ffdd5bd","42c5578ebe06dcd5"]]},{"id":"a58995f11ffdd5bd","type":"function","z":"bd155946fc3867cf","name":"function 94","func":"if (msg.brokerId !=  \"500001\") return;\nif (msg.topic !=  \"__status/connection\") return;\n\nconst payload =  msg.payload;\n\nif(payload == \"connected\"){\n\n    msg.payload = true;\n    \n}else{\n\n    msg.payload = false;\n    \n}\n\n\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1130,"y":320,"wires":[["1c5e538b527888ab"]]},{"id":"61f1f5fcdf165042","type":"function","z":"bd155946fc3867cf","name":"function 95","func":"// const client_id = Date.now() + 1000;\nconst client_id  = \"500001\";\n\n//global.set(\"client_id\", client_id + 1000);\nconst host = global.get(\"mqtt_broker_ad\") || \"\";\nconst port = global.get(\"mqtt_porta\") || \"\";\nconst username = global.get(\"mqtt_usuario_ad\") || \"\";\nconst password = global.get(\"mqtt_senha_ad\") || \"\";\n\nmsg.command = \"__add_broker\";\nmsg.brokerId = client_id,\nmsg.payload = {\n    subscriptions: [\"tele/+/RESULT\",  \"ad/+/infrared\"],\n      options: {\n          protocol:  'mqtt',\n          port,\n          host,\n          \"clientId\" : client_id,\n          username,\n          password\n      }\n  }\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":340,"wires":[["f75252c1dcdbab4a","42c5578ebe06dcd5"]]},{"id":"2657dcd5037bc261","type":"mqtt one","z":"bd155946fc3867cf","name":"","x":890,"y":540,"wires":[[]]},{"id":"42c5578ebe06dcd5","type":"debug","z":"bd155946fc3867cf","name":"debug 33","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1040,"y":420,"wires":[]},{"id":"251eb852741e5db2","type":"ui-template","z":"bd155946fc3867cf","group":"3ebd4505c5a6d063","page":"","ui":"","name":"","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <v-container>\n    <v-row align=\"center\" justify=\"center\">\n        \n\n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" color=\"red\" @click=\"send({payload: 'limparcon1'})\">\n        <v-icon icon=\"mdi-delete-circle-outline\" start>\n        </v-icon>\n            Limpar\n        </v-btn>\n\n      </v-col>\n\n    </v-row>\n  </v-container>\n</template>\n\n\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":280,"y":780,"wires":[["7cb75ab0d1d54479"]]},{"id":"7cb75ab0d1d54479","type":"function","z":"bd155946fc3867cf","name":"function 100","func":"msg.payload = \"\";\nflow.set(\"mensagem\", \"\");\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":780,"wires":[["e708e1e4787595ce"]]},{"id":"6dc8724316f10d12","type":"function","z":"f879cf30d22aec46","name":"function 1","func":"const topic = msg.topic;\nconst payload = msg.payload;\n\nif (msg.brokerId != \"300001\") return;\nconst padrao = /^tele.*RESULT$/;\nif (!padrao.test(topic)) return;\n\n\nlet tentativa = 2\n\n\n\nvar msg1 = null;\nvar msg2 = null;\nmsg1 = Object.assign({}, msg);\nmsg2 = Object.assign({}, msg);\n\nconst matches = topic.match(/^([^\\/]+)\\/([^\\/]+)\\/([^\\/]+)$/);\n\nif (matches) {\n    const [, firstValue, device, thirdValue] = matches;\n    msg.payload = device;\n\n} else {\n    msg.payload = \"\";\n}\n\n\n\n\nconst protocolo  = payload.IrReceived.Protocol;\n\nif (protocolo == \"UNKNOWN\"){\n    tentativa = flow.get(\"tentativa\") || 0;\n    tentativa = tentativa + 1;\n    flow.set(\"tentativa\", tentativa);\n    msg2.payload = `Tentavia ${tentativa} -- ${JSON.stringify(payload.IrReceived)}`\n    return [msg, null, msg2];\n}else{\n    flow.set(\"tentativa\", 0);\n    msg1.payload = JSON.stringify(payload.IrReceived);\n    msg2.payload = \"OK\";\n    return [msg, msg1, msg2];\n}\n\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":120,"wires":[["047b0698620f5b53"],["4845aae0c44a3e8d"],["3b9f7031d8fb6bf8"]]},{"id":"6ae00805bfe04d0b","type":"function","z":"f879cf30d22aec46","name":"function 2","func":"const tipo_device = msg.payload;\nflow.set(\"tipo_device_infravermelho\", tipo_device);\n\nconst payload_tag_tv = [\n{value: \"power\", label: \"Power\"},\n{ value: \"play\", label: \"Play\" },\n{ value: \"menu\", label: \"Menu\" },\n{ value: \"input\", label: \"Input\" },\n{ value: \"exit\", label: \"Exit\" },\n{ value: \"up\", label: \"UP (Seta para Cima)\" },\n{ value: \"down\", label: \"Down (Seta para baixo)\" },\n{ value: \"left\", label: \"Down (Seta para Esquerda)\" },\n{ value: \"right\", label: \"Down (Seta para Direita)\" },\n{ value: \"ok\", label: \"OK (Comando Confirma)\" },\n{ value: \"chup\", label: \"Canal Mais 1\" },\n{ value: \"chdown\", label: \"Canal Menos 1\" },\n{ value: \"volup\", label: \"Aumenta Volume um nivel\" },\n{ value: \"volup10\", label: \"Aumenta Volume 10 niveis\" },\n{ value: \"voldown\", label: \"Diminui Volume um nivel\" },\n{ value: \"voldown10\", label: \"Diminui Volume 10 niveis\" },\n{ value: \"mute\", label: \"Mudo\" },\n{ value: \"1\", label: \"Numero 1\" },\n{ value: \"2\", label: \"Numero 2\" },\n{ value: \"3\", label: \"Numero 3\" },\n{ value: \"4\", label: \"Numero 4\" },\n{ value: \"5\", label: \"Numero 5\" },\n{ value: \"6\", label: \"Numero 6\" },\n{ value: \"7\", label: \"Numero 7\" },\n{ value: \"8\", label: \"Numero 8\" },\n{ value: \"9\", label: \"Numero 9\" },\n{ value: \"0\", label: \"Numero 0\" },\n{ value: \".\", label: \"Numero .\" },\n{ value: \"netflix\", label: \"Netflix\" },\n{ value: \"disneyplus\", label: \"Disney Plus\" },\n{ value: \"hbomax\", label: \"Hbomax\" },\n{ value: \"primevideo\", label: \"Prime Video\" },\n{ value: \"starplus\", label: \"Star Plus\" },\n{ value: \"appletv\", label: \"Applet TV\" },\n{ value: \"telecine\", label: \"TeleCine\" },\n{ value: \"globoplay\", label: \"Globo Play\" },\n{ value: \"youtube\", label: \"Youtube\" },\n{ value: \"twitch\", label: \"Twitch\" },\n{ value: \"open\", label: \"Comando Abrir (USando para mover modulo de TV/Projetor)\" },\n{ value: \"stop\", label: \"Comando Parar (USando para mover modulo de TV/Projetor)\" },\n{ value: \"close\", label: \"Comando Fechar (USando para mover modulo de TV/Projetor)\" }\n];\n\nconst payload_tag_ac_sp = [\n    {value: \"off\", label: \"Desligar\"},\n    { value: \"on_12\", label: \"Ligar/Seta na temperatura 12\" },\n    { value: \"on_13\", label: \"Ligar/Seta na temperatura 13\" },\n    { value: \"on_14\", label: \"Ligar/Seta na temperatura 14\" },\n    { value: \"on_15\", label: \"Ligar/Seta na temperatura 15\" },\n    { value: \"on_16\", label: \"Ligar/Seta na temperatura 16\" },\n    { value: \"on_17\", label: \"Ligar/Seta na temperatura 17\" },\n    { value: \"on_18\", label: \"Ligar/Seta na temperatura 18\"},\n    { value: \"on_19\", label: \"Ligar/Seta na temperatura 19\" },\n    { value: \"on_20\", label: \"Ligar/Seta na temperatura 20\" },\n    { value: \"on_21\", label: \"Ligar/Seta na temperatura 21\" },\n    { value: \"on_22\", label: \"Ligar/Seta na temperatura 22\" },\n    { value: \"on_23\", label: \"Ligar/Seta na temperatura 23\" },\n    { value: \"on_24\", label: \"Ligar/Seta na temperatura 24\" },\n    { value: \"on_25\", label: \"Ligar/Seta na temperatura 25\" },\n    { value: \"on_26\", label: \"Ligar/Seta na temperatura 26\" },\n    { value: \"on_27\", label: \"Ligar/Seta na temperatura 27\" },\n    { value: \"on_28\", label: \"Ligar/Seta na temperatura 28\" },\n    { value: \"on_29\", label: \"Ligar/Seta na temperatura 29\" },\n    { value: \"on_30\", label: \"Ligar/Seta na temperatura 30\" },\n];\n\nif(tipo_device == \"arcondicionadosimplificado\"){\n\n    msg.options = payload_tag_ac_sp;\n\n}else if(tipo_device == \"arcondicionadoextendido\"){\n    \n    msg.options = [];\n\n    msg.class = {\n    display: \"none\"\n    }\n    \n}else if(tipo_device == \"TV\"){\n    \n    msg.options = payload_tag_tv;\n}\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":580,"wires":[["83627a8bc57c2b7f"]]},{"id":"a7db0a95b9ee4a9c","type":"function","z":"f879cf30d22aec46","name":"function 3","func":"msg.payload = {\n    groups: {\n        disable: ['<Group Name>']\n    }\n}\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":680,"wires":[["83627a8bc57c2b7f"]]},{"id":"b86b1c49790c862f","type":"function","z":"f879cf30d22aec46","name":"function 4","func":"const tipo_codigo = msg.payload;\n\nvar msg1 = null;\nmsg1 = Object.assign({}, msg);\n\nif(tipo_codigo == \"Simplificado\"){\n\n    msg.payload = {\n        groups: {\n            show: ['Ir Code ADD:salvarir_group'],\n            hide: ['Ir Code ADD:Salvar_ir_group_ex']\n        }\n    }\n    msg1.payload = \"AC_S\";\n\n} else if (tipo_codigo == \"Extendido\") {\n\n    msg.payload = {\n        groups: {\n            show: ['Ir Code ADD:Salvar_ir_group_ex'],\n            hide: ['Ir Code ADD:salvarir_group']\n        }\n\n    }\n\n    msg1.payload = \"AC_E\";\n\n}\nreturn [msg, msg1];\n","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":180,"wires":[["9cfe2efbe5c5aa0b"],["40e71d863a59a871"]]},{"id":"357ce440872d02f3","type":"function","z":"f879cf30d22aec46","name":"function 17","func":"const blaster_infravermelho = msg.payload;\nflow.set(\"blaster_infravermelho\", blaster_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":100,"wires":[[]]},{"id":"230d3fe1579a677d","type":"function","z":"f879cf30d22aec46","name":"function 18","func":"const codigo_infravermelho = msg.payload;\nflow.set(\"codigo_infravermelho\", codigo_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":140,"wires":[[]]},{"id":"b9a0a8f4834c906e","type":"function","z":"f879cf30d22aec46","name":"function 19","func":"const codigo_infravermelho = flow.get(\"codigo_infravermelho\") || \"\";\nconst blaster_infravermelho = flow.get(\"blaster_infravermelho\") || \"\";\n\nvar msg1 = null;\nmsg1 = Object.assign({}, msg);\n\nmsg.payload = blaster_infravermelho;\nmsg1.payload = codigo_infravermelho;\n\n\nreturn [msg, msg1];\n","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":240,"wires":[["9e38705f82367f1f","c3a38ea8c7c35a1d"],["7c5e206dabea29c1","44385d013ba42a8f"]]},{"id":"a5ded341d3b683c3","type":"function","z":"f879cf30d22aec46","name":"function 20","func":"const codigo_dispositivo_infrared = msg.payload;\nflow.set(\"codigo_dispositivo_infrared\", codigo_dispositivo_infrared);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":620,"wires":[[]]},{"id":"2debe2b6ffff9b54","type":"function","z":"f879cf30d22aec46","name":"function 21","func":"const button_tag = msg.payload;\nflow.set(\"button_tag\", button_tag);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":620,"wires":[[]]},{"id":"de4faa73a3327366","type":"function","z":"f879cf30d22aec46","name":"function 22","func":"const codigo_infravermelho = flow.get(\"codigo_infravermelho\") || \"\";\nconst blaster_infravermelho = flow.get(\"blaster_infravermelho\") || \"\";\nconst button_tag = flow.get(\"button_tag\") || \"\";\nconst codigo_dispositivo_infrared = flow.get(\"codigo_dispositivo_infrared\") || \"\";\nconst marca_dispositivo_infrared = flow.get(\"marca_dispositivo_infrared\") || \"\";\nconst modelo_dispositivo_infrared = flow.get(\"modelo_dispositivo_infrared\") || \"\";\nlet tipo_device_infravermelho = flow.get(\"tipo_device_infravermelho\") || \"\";\n\nif (tipo_device_infravermelho == \"arcondicionadosimplificado\"){\n    tipo_device_infravermelho = \"AC_S\"\n} else if (tipo_device_infravermelho == \"arcondicionadoextendido\") {\n    tipo_device_infravermelho = \"AC_E\"\n}\n\nconst comando = msg.payload;\n\n\nconst client_id  = \"200001\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\n\nif (comando == \"savecon1\"){\n\n    var msg1 = null;\n    msg1 = Object.assign({}, msg);\n\n\n    msg1.payload = `${blaster_infravermelho} - ${codigo_infravermelho} - ${codigo_dispositivo_infrared} - ${button_tag}`;\n\n    const topic = `\n        INSERT INTO infrared (device, ir_id, tagcode, code, marca, modelo, tipo)\n        SELECT '${codigo_dispositivo_infrared}', '${blaster_infravermelho}', '${button_tag}', '${codigo_infravermelho}', '${marca_dispositivo_infrared}', '${modelo_dispositivo_infrared}' , '${tipo_device_infravermelho}'\n        WHERE NOT EXISTS (\n            SELECT 1 FROM infrared \n            WHERE device = '${codigo_dispositivo_infrared}' AND ir_id = '${blaster_infravermelho}' AND tagcode = '${button_tag}'\n        );\n    `;\n\n    msg.topic = topic;\n\n    return [msg, msg1, null];\n\n}else if(comando == \"sendir\"){\n\n    const topic = `cmnd/${blaster_infravermelho}/irsend`\n    msg.topic = topic;\n\n    let codigo_json = \"\";\n        try {\n        codigo_json = JSON.parse(codigo_infravermelho);\n    } catch (error) {\n        codigo_json = codigo_infravermelho;\n    };\n\n\n    msg.payload = codigo_json;\n\n    return [null, null, msg];\n}\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":800,"wires":[["71b708e9878c6c87"],["be3dda5c5376f148"],["16bae6264c0f0f1d"]]},{"id":"2c94c6b627743f07","type":"function","z":"f879cf30d22aec46","name":"function 23","func":"const button_tag = msg.payload;\nflow.set(\"button_tag\", button_tag);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1040,"wires":[[]]},{"id":"50d89f9737fbe153","type":"function","z":"f879cf30d22aec46","name":"function 24","func":"const codigo_dispositivo_infrared = msg.payload;\nflow.set(\"codigo_dispositivo_infrared\", codigo_dispositivo_infrared);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1080,"wires":[[]]},{"id":"1d3429b6327dcb8d","type":"function","z":"f879cf30d22aec46","name":"function 25","func":"const codigo_infravermelho = flow.get(\"codigo_infravermelho\") || \"\";\nconst blaster_infravermelho = flow.get(\"blaster_infravermelho\") || \"\";\nconst button_tag = flow.get(\"button_tag\") || \"\";\nconst codigo_dispositivo_infrared = flow.get(\"codigo_dispositivo_infrared\") || \"\";\nconst marca_dispositivo_infrared = flow.get(\"marca_dispositivo_infrared\") || \"\";\nconst modelo_dispositivo_infrared = flow.get(\"modelo_dispositivo_infrared\") || \"\";\nlet tipo_device_infravermelho = flow.get(\"tipo_device_infravermelho\") || \"\";\n\nif (tipo_device_infravermelho == \"arcondicionadosimplificado\"){\n    tipo_device_infravermelho = \"AC_S\"\n} else if (tipo_device_infravermelho == \"arcondicionadoextendido\") {\n    tipo_device_infravermelho = \"AC_E\"\n}\n\nconst client_id  = \"300001\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\nconst comando = msg.payload;\n\n\n\n\nif (comando == \"savecon1\"){\n\nvar msg1 = null;\nmsg1 = Object.assign({}, msg);\n\n\nmsg1.payload = `${blaster_infravermelho} - ${codigo_infravermelho} - ${codigo_dispositivo_infrared} - ${button_tag}`;\n\nconst topic = `\n    INSERT INTO infrared (device, ir_id, tagcode, code, marca, modelo, tipo)\n    SELECT '${codigo_dispositivo_infrared}', '${blaster_infravermelho}', '${button_tag}', '${codigo_infravermelho}', '${marca_dispositivo_infrared}', '${modelo_dispositivo_infrared}' , '${tipo_device_infravermelho}'\n    WHERE NOT EXISTS (\n        SELECT 1 FROM infrared \n        WHERE device = '${codigo_dispositivo_infrared}' AND ir_id = '${blaster_infravermelho}' AND tagcode = '${button_tag}'\n    );\n`;\n\nmsg.topic = topic;\n\nreturn [msg, msg1];\n\n}else if(comando == \"sendir\"){\n\n    const topic = `cmnd/${blaster_infravermelho}/irsend`\n    msg.topic = topic;\n\n    let codigo_json = codigo_infravermelho;\n\n    try {\n        codigo_json = JSON.parse(codigo_infravermelho);\n    } catch (error) {\n        codigo_json = codigo_infravermelho;\n    };\n\n\n    msg.payload = codigo_json;\n    \n    return [null, null, msg];\n}\n\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":1220,"wires":[["71b708e9878c6c87"],["71393734ef39a679"],["16bae6264c0f0f1d"]]},{"id":"9fb005f3345dd49d","type":"function","z":"f879cf30d22aec46","name":"function 49","func":"const marca_dispositivo = msg.payload;\nflow.set(\"marca_dispositivo_infrared\", marca_dispositivo);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":720,"wires":[[]]},{"id":"c79dcdce3719e465","type":"function","z":"f879cf30d22aec46","name":"function 50","func":"const modelo_dispositivo = msg.payload;\nflow.set(\"modelo_dispositivo_infrared\", modelo_dispositivo);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":760,"wires":[[]]},{"id":"c89bc2e621fd6383","type":"function","z":"f879cf30d22aec46","name":"function 51","func":"const blaster_infravermelho = msg.payload;\nflow.set(\"blaster_infravermelho\", blaster_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":580,"wires":[[]]},{"id":"321d603b5b369f3a","type":"function","z":"f879cf30d22aec46","name":"function 52","func":"const codigo_infravermelho = msg.payload;\nflow.set(\"codigo_infravermelho\", codigo_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":620,"wires":[[]]},{"id":"91620c01243a153f","type":"function","z":"f879cf30d22aec46","name":"function 53","func":"const blaster_infravermelho = msg.payload;\nflow.set(\"blaster_infravermelho\", blaster_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":1040,"wires":[[]]},{"id":"a4b657f5ab6abcb7","type":"function","z":"f879cf30d22aec46","name":"function 54","func":"const codigo_infravermelho = msg.payload;\nflow.set(\"codigo_infravermelho\", codigo_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":1080,"wires":[[]]},{"id":"420cab7ff91ed569","type":"function","z":"f879cf30d22aec46","name":"function 55","func":"const marca_dispositivo = msg.payload;\nflow.set(\"marca_dispositivo_infrared\", marca_dispositivo);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1120,"wires":[[]]},{"id":"089a5569baf8afb2","type":"function","z":"f879cf30d22aec46","name":"function 56","func":"const modelo_dispositivo = msg.payload;\nflow.set(\"modelo_dispositivo_infrared\", modelo_dispositivo);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":1160,"wires":[[]]},{"id":"fe14d45fbe43a867","type":"function","z":"f879cf30d22aec46","name":"function 62","func":"const codigo_dispositivo_infrared = msg.payload;\nflow.set(\"codigo_dispositivo_infrared\", codigo_dispositivo_infrared);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":360,"wires":[[]]},{"id":"fb9167a092137225","type":"function","z":"f879cf30d22aec46","name":"function 63","func":"const button_tag = msg.payload;\nflow.set(\"button_tag\", button_tag);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":400,"wires":[[]]},{"id":"c4b0230df577d8cd","type":"function","z":"f879cf30d22aec46","name":"function 64","func":"const codigo_dispositivo_infrared = flow.get(\"codigo_dispositivo_infrared\") || \"\";\nconst button_tag = flow.get(\"button_tag\") || \"\";\n\nvar msg1 = null;\nmsg1 = Object.assign({}, msg);\n\nmsg.payload = codigo_dispositivo_infrared;\nmsg1.payload = button_tag;\n\n\nreturn [msg, msg1];\n","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":440,"wires":[["8a4c0fec1f90268a","10655e0c409b0151"],["f09d6d2493439a04"]]},{"id":"a680ab02f948c357","type":"function","z":"f879cf30d22aec46","name":"function 65","func":"const topic = msg.topic;\nconst codigo = msg.payload;\n\nif (msg.brokerId != \"300001\") return;\nconst padrao = /^ad.*infrared$/;\nif (!padrao.test(topic)) return;\n\nconst topic_tv = \"ad/tv/infrared\";\nconst topic_md = \"ad/md/infrared\";\nconst topic_ar = \"ad/ar/infrared\";\n\n\nif(topic == topic_tv) return;\nif(topic == topic_md) return;\nif(topic == topic_ar) return;\n\n\nvar string = \"ad/11_0102030405/infrared\";\nvar match = topic.match(/\\/(\\d+_+\\d+)/);\nif (match) {\n    var msg1 = null;\n    msg1 = Object.assign({}, msg);\n    const extracted = match[1];\n\n    msg.payload = extracted;\n    msg1.payload = codigo;\n    return [ msg, msg1 ];\n\n} else {\n    return;\n}\n\n\nreturn msg;","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":360,"wires":[["11edcfbaf6cbcc20"],["e62224e3fc646b04"]]},{"id":"40e71d863a59a871","type":"function","z":"f879cf30d22aec46","name":"function 66","func":"const tipo_device_infravermelho = msg.payload;\nflow.set(\"tipo_device_infravermelho\", tipo_device_infravermelho);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":200,"wires":[[]]},{"id":"047b0698620f5b53","type":"ui-text-input","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"Blaster Infravermelho","label":"Blaster Infravermelho","order":2,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":500,"y":60,"wires":[["357ce440872d02f3"]]},{"id":"4845aae0c44a3e8d","type":"ui-text-input","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"Código Infravermelho","label":"Código Infravermelho","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":500,"y":100,"wires":[["230d3fe1579a677d"]]},{"id":"9e38705f82367f1f","type":"ui-text-input","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"Blaster Infravermelho","label":"Blaster Infravermelho","order":2,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":1140,"y":580,"wires":[["c89bc2e621fd6383"]]},{"id":"7c5e206dabea29c1","type":"ui-text-input","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"Código Infravermelho","label":"Código Infravermelho","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":1140,"y":620,"wires":[["321d603b5b369f3a"]]},{"id":"8a4c0fec1f90268a","type":"ui-text-input","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"Código Dispositivo","label":"Dispositivo Infravermelho","order":5,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":230,"y":620,"wires":[["a5ded341d3b683c3"]]},{"id":"c3a38ea8c7c35a1d","type":"ui-text-input","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"Blaster Infravermelho","label":"Blaster Infravermelho","order":2,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":1140,"y":1040,"wires":[["91620c01243a153f"]]},{"id":"44385d013ba42a8f","type":"ui-text-input","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"Código Infravermelho","label":"Código Infravermelho","order":3,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":1140,"y":1080,"wires":[["a4b657f5ab6abcb7"]]},{"id":"f09d6d2493439a04","type":"ui-text-input","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"ButtonTAG","label":"ButtonTAG","order":5,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":170,"y":1040,"wires":[["2c94c6b627743f07"]]},{"id":"10655e0c409b0151","type":"ui-text-input","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"Código Dispositivo","label":"Código Dispositivo","order":4,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":190,"y":1080,"wires":[["50d89f9737fbe153"]]},{"id":"8e6e882e8dedd6fd","type":"ui-text-input","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"ModeloEquipamento","label":"Modelo Equipamento","order":8,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":180,"y":760,"wires":[["c79dcdce3719e465"]]},{"id":"72216a9257456ddf","type":"ui-text-input","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"MarcaEquipamento","label":"Marca Equipamento","order":7,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":170,"y":720,"wires":[["9fb005f3345dd49d"]]},{"id":"ad449c66cec4b62f","type":"ui-text-input","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"MarcaEquipamento","label":"Marca Equipamento","order":6,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":190,"y":1120,"wires":[["420cab7ff91ed569"]]},{"id":"da1d34a4b7ba8e86","type":"ui-text-input","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"ModeloEquipamento","label":"Modelo Equipamento","order":7,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":200,"y":1160,"wires":[["089a5569baf8afb2"]]},{"id":"11edcfbaf6cbcc20","type":"ui-text-input","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"Dispositivo Infravermelho","label":"Dispositivo Infravermelho","order":8,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":510,"y":360,"wires":[["fe14d45fbe43a867"]]},{"id":"e62224e3fc646b04","type":"ui-text-input","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"Button Tag","label":"Button Tag","order":9,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":470,"y":400,"wires":[["fb9167a092137225"]]},{"id":"d5c1d7ec24a7e632","type":"ui-button","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"","label":"Incluir Codigo Infravermelho","order":6,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":140,"y":300,"wires":[["b9a0a8f4834c906e","8066c905edfb3b17"]]},{"id":"7d45c826f51847a7","type":"ui-button","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"","label":"Incluir Button Tag","order":10,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":490,"y":440,"wires":[["c4b0230df577d8cd"]]},{"id":"83627a8bc57c2b7f","type":"ui-dropdown","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"Selecionar Button Tag","label":"Selecionar Button Tag","tooltip":"","order":6,"width":0,"height":0,"passthru":false,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"topic","topicType":"msg","className":"cscbuttontag","x":660,"y":620,"wires":[["2debe2b6ffff9b54"]]},{"id":"5bace3c90808d9cb","type":"ui-radio-group","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","name":"Tipo Dispositivo","label":"Tipo Dispositivo","order":4,"width":0,"height":0,"columns":"3","passthru":false,"options":[{"label":"TV","value":"TV","type":"str"},{"label":"Ar Condicionado","value":"arcondicionadosimplificado","type":"str"}],"payload":"","topic":"topic","topicType":"msg","className":"","x":220,"y":580,"wires":[["6ae00805bfe04d0b","a7db0a95b9ee4a9c"]]},{"id":"f462c8050fc26d02","type":"ui-radio-group","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","name":"Tipo de Código","label":"Tipo de Código","order":5,"width":0,"height":0,"columns":"2","passthru":false,"options":[{"label":"Simplificado","value":"Simplificado","type":"str"},{"label":"Extendido","value":"Extendido","type":"str"}],"payload":"","topic":"topic","topicType":"msg","className":"","x":480,"y":180,"wires":[["b86b1c49790c862f"]]},{"id":"56575bf1c390a97f","type":"ui-text","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","order":1,"width":0,"height":0,"name":"Ouvir Infrared","label":"Ouvir Infravermelho","format":"{{msg.payload}}","layout":"row-center","style":true,"font":"","fontSize":"25","color":"#0011ff","className":"","x":480,"y":20,"wires":[]},{"id":"4193328e406680d4","type":"ui-text","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","order":1,"width":0,"height":0,"name":"Salvar Infravermelho","label":"Salvar Infravermelho","format":"{{msg.payload}}","layout":"row-center","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":180,"y":540,"wires":[]},{"id":"7065375293361654","type":"ui-text","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","order":1,"width":0,"height":0,"name":"Salvar Infravermelho","label":"Salvar Infravermelho","format":"{{msg.payload}}","layout":"row-center","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":340,"y":920,"wires":[]},{"id":"be3dda5c5376f148","type":"ui-text","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","order":9,"width":0,"height":0,"name":"mostrar_codigo_ir","label":"Dados:","format":"{{msg.payload}}","layout":"row-spread","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":850,"y":820,"wires":[]},{"id":"71393734ef39a679","type":"ui-text","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","order":8,"width":0,"height":0,"name":"mostrar_codigo_ir","label":"Dados:","format":"{{msg.payload}}","layout":"row-spread","style":false,"font":"","fontSize":16,"color":"#717171","className":"","x":690,"y":1220,"wires":[]},{"id":"c9ca6bf9e967e43b","type":"ui-text","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","order":7,"width":0,"height":0,"name":"Ouvir ButtonTag","label":"Ouvir ButtonTag","format":"{{msg.payload}}","layout":"row-center","style":true,"font":"","fontSize":"25","color":"#0400ff","className":"","x":480,"y":300,"wires":[]},{"id":"2245e04f63d6376f","type":"ui-template","z":"f879cf30d22aec46","group":"5ad88dda6fe98f33","page":"","ui":"","name":"salva_ir_simplificado","order":10,"width":0,"height":0,"head":"","format":"<template>\n  <v-container>\n    <v-row align=\"center\" justify=\"center\">\n        \n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" @click=\"send({payload: 'savecon1'})\">\n        <v-icon icon=\"mdi-content-save-outline\" start>\n        </v-icon>\n           Salvar\n        </v-btn>\n        \n      </v-col>\n\n    <v-col cols=\"auto\">\n        <v-btn icon=\"mdi-remote\" size=\"x-large\" @click=\"send({payload: 'sendir'})\"></v-btn>\n      </v-col>\n\n\n    </v-row>\n  </v-container>\n</template>\n\n\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":180,"y":800,"wires":[["de4faa73a3327366"]]},{"id":"38d47f468911e8ce","type":"ui-template","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","page":"","ui":"","name":"salva_ir_simplificado","order":9,"width":0,"height":0,"head":"","format":"<template>\n  <v-container>\n    <v-row align=\"center\" justify=\"center\">\n        \n      <v-col cols=\"auto\">\n\n        <v-btn class=\"ma-2\" @click=\"send({payload: 'savecon1'})\">\n        <v-icon icon=\"mdi-content-save-outline\" start>\n        </v-icon>\n           Salvar\n        </v-btn>\n        \n      </v-col>\n\n    <v-col cols=\"auto\">\n        <v-btn icon=\"mdi-remote\" size=\"x-large\" @click=\"send({payload: 'sendir'})\"></v-btn>\n      </v-col>\n\n\n    </v-row>\n  </v-container>\n</template>\n\n\n<style>\n    /* define any styles here - supports raw CSS */\n    .my-class {\n        color: red;\n    }\n</style>","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":120,"y":1220,"wires":[["1d3429b6327dcb8d"]]},{"id":"9cfe2efbe5c5aa0b","type":"ui-control","z":"f879cf30d22aec46","name":"","ui":"17f0c29053c20d2e","events":"all","x":900,"y":160,"wires":[[]]},{"id":"71b708e9878c6c87","type":"sqlite","z":"f879cf30d22aec46","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":700,"y":1060,"wires":[[]]},{"id":"f7636d8d232892af","type":"ui-radio-group","z":"f879cf30d22aec46","group":"f1151d10cc234b8a","name":"Tipo Dispositivo","label":"Tipo Dispositivo","order":4,"width":0,"height":0,"columns":"3","passthru":false,"options":[{"label":"TV","value":"TV","type":"str"},{"label":"Ar Condicionado","value":"arcondicionadosimplificado","type":"str"}],"payload":"","topic":"topic","topicType":"msg","className":"","x":240,"y":1000,"wires":[["980ee018dd0e3434"]]},{"id":"980ee018dd0e3434","type":"function","z":"f879cf30d22aec46","name":"function 80","func":"const tipo_device = msg.payload;\nflow.set(\"tipo_device_infravermelho\", tipo_device);\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":1000,"wires":[[]]},{"id":"3b9f7031d8fb6bf8","type":"ui-text","z":"f879cf30d22aec46","group":"fe4e38f1ebf658ab","order":4,"width":0,"height":0,"name":"Ouvir Infrared","label":"","format":"{{msg.payload}}","layout":"row-center","style":true,"font":"","fontSize":"11","color":"#fe0606","className":"","x":480,"y":140,"wires":[]},{"id":"8066c905edfb3b17","type":"function","z":"f879cf30d22aec46","name":"function 81","func":"flow.set(\"tentativa\", 0);\nmsg.payload = \"\";\nreturn msg\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":290,"y":260,"wires":[["3b9f7031d8fb6bf8"]]},{"id":"16bae6264c0f0f1d","type":"mqtt one","z":"f879cf30d22aec46","name":"","x":910,"y":1060,"wires":[[]]},{"id":"ab4dd4c1aa8735eb","type":"mqtt one","z":"f879cf30d22aec46","name":"","x":90,"y":180,"wires":[["6dc8724316f10d12","a680ab02f948c357"]]},{"id":"49518049ceead1c2","type":"function","z":"5a2f87efbe0647a9","name":"function 57","func":"const id_device_blaster_seache = flow.get(\"id_device_blaster_seache\") || \"\";\n\n\nif (id_device_blaster_seache == \"*\"){\n\n   const topic = `SELECT * FROM infrared;`;\n    msg.topic = topic;\n    return msg\n\n}else{\n\n    const topic = `\n        SELECT * FROM infrared WHERE device = '${id_device_blaster_seache}' OR ir_id = '${id_device_blaster_seache}';\n    `;\n\n    msg.topic = topic;\n    return msg\n\n\n}\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":80,"wires":[["5276746657afe9d0"]]},{"id":"1bfdd89e99dfc424","type":"function","z":"5a2f87efbe0647a9","name":"function 58","func":"const id_device_blaster_seache = msg.payload;\nflow.set(\"id_device_blaster_seache\", id_device_blaster_seache);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":40,"wires":[[]]},{"id":"2dca5a5c9be5239a","type":"debug","z":"5a2f87efbe0647a9","name":"debug 22","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":880,"y":240,"wires":[]},{"id":"a682a08d6eaac47b","type":"function","z":"5a2f87efbe0647a9","name":"function 59","func":"const itens_selected = msg.payload;\nflow.set(\"itens_selected\", itens_selected);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":180,"wires":[[]]},{"id":"5005c2b3c55dd8d6","type":"function","z":"5a2f87efbe0647a9","name":"function 60","func":"const itens_selected = flow.get(\"itens_selected\") || [];\n\nlet outputMsgs = [];\n\nfor (let index = 0; index < itens_selected.length; index++) {\n    const item = itens_selected[index];\n\n    const topic = `\n        DELETE FROM infrared WHERE id = ${item.id};\n    `;\n\n    outputMsgs.push({ topic });\n    \n}\n\n\n\nreturn [outputMsgs];\n\n\n\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":220,"wires":[["171b50b5021e7bf4"]]},{"id":"c6972b6d63448ac5","type":"ui-text-input","z":"5a2f87efbe0647a9","group":"06378199283358d5","name":"Item Buscar","label":"Código Dispositivo/Blaster","order":1,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":130,"y":40,"wires":[["1bfdd89e99dfc424"]]},{"id":"13e56527ba517d4f","type":"ui-button","z":"5a2f87efbe0647a9","group":"06378199283358d5","name":"","label":"Buscar","order":2,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":120,"y":80,"wires":[["49518049ceead1c2"]]},{"id":"2ecf29a5d46b79a0","type":"ui-button","z":"5a2f87efbe0647a9","group":"06378199283358d5","name":"","label":"Apagar","order":4,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":140,"y":220,"wires":[["5005c2b3c55dd8d6"]]},{"id":"88b5de3553d00783","type":"ui-table","z":"5a2f87efbe0647a9","group":"06378199283358d5","name":"Infrared List","label":"text","order":3,"width":0,"height":0,"maxrows":"15","passthru":false,"autocols":true,"selectionType":"checkbox","columns":[],"x":670,"y":140,"wires":[["a682a08d6eaac47b","2dca5a5c9be5239a"]]},{"id":"5276746657afe9d0","type":"sqlite","z":"5a2f87efbe0647a9","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":660,"y":80,"wires":[["88b5de3553d00783"]]},{"id":"171b50b5021e7bf4","type":"sqlite","z":"5a2f87efbe0647a9","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":580,"y":220,"wires":[["49518049ceead1c2"]]},{"id":"0075d9d59919f855","type":"function","z":"e9473a462f630fe6","name":"function 69","func":"const payload = msg.payload;\n\nconst nome_sala = payload.nomedispositivo;\n\nconst valido = nome_sala.length >= 3 ? true : false;\n\nif(!valido) return;\n\nconst topic = `INSERT INTO device_ir (name, type, unique_id) VALUES ('${nome_sala}', 'TV', '11_' || strftime('%s', 'now'))`;\n\nmsg.topic = topic;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":140,"wires":[["8212c9d02528cf9d"]]},{"id":"ba035b910f67514d","type":"function","z":"e9473a462f630fe6","name":"function 70","func":"const payload = msg.payload;\n\nconst nomedispositivo   = payload.nomedispositivo;\nconst ac_mode       = JSON.stringify(payload.ac_mode).replace(/\"/g, \"'\");\nconst swing_modes   = JSON.stringify(payload.swing_modes).replace(/\"/g, \"'\");\nconst fan_modes     = JSON.stringify(payload.fan_modes).replace(/\"/g, \"'\");\nconst preset_modes  = JSON.stringify(payload.preset_modes).replace(/\"/g, \"'\");\nconst tempmin       = payload.tempmin;\nconst tempmax       = payload.tempmax;\nconst tipo_ac       = payload.tipo_ar;\n\n\nlet valido = nomedispositivo.length >= 3 ? true : false;\nif(!valido) return;\n\n\n\nconst topic = `\nINSERT INTO device_ir (name, type, unique_id, ac_modes, ac_swing_modes, ac_fan_modes, ac_preset_modes, ac_min_temp, ac_max_temp) \nVALUES \n('${nomedispositivo}', '${tipo_ac}', '10_' || strftime('%s', 'now'), \"${ac_mode}\", \"${swing_modes}\", \"${fan_modes}\", \"${preset_modes}\", ${tempmin}, ${tempmax})\n`;\n\nmsg.topic = topic;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":240,"wires":[["8212c9d02528cf9d"]]},{"id":"591bb0b1a4af74dd","type":"function","z":"e9473a462f630fe6","name":"function 71","func":"const device_list = msg.payload;\nflow.set(\"device_list\", device_list);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1250,"y":380,"wires":[[]]},{"id":"96349ae727229b37","type":"function","z":"e9473a462f630fe6","name":"function 72","func":"const device_list = flow.get(\"device_list\") || \"\";\n\n\nif (device_list == \"*\"){\n\n   const topic = `SELECT * FROM device_ir;`;\n    msg.topic = topic;\n    return msg\n\n}else{\n\n    const topic = `\n        SELECT * FROM device_ir WHERE type = '${device_list}' OR name = '${device_list}' OR unique_id = '${device_list}';\n    `;\n\n    msg.topic = topic;\n    return msg\n\n\n}\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1230,"y":420,"wires":[["c0ac81927c6d0608"]]},{"id":"b175352a79035d33","type":"function","z":"e9473a462f630fe6","name":"function 73","func":"const itens_selected = msg.payload;\nflow.set(\"itens_selected\", itens_selected);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1690,"y":420,"wires":[[]]},{"id":"1e1f94ae2c36fd43","type":"function","z":"e9473a462f630fe6","name":"function 74","func":"const itens_selected = flow.get(\"itens_selected\") || [];\n\nlet outputMsgs = [];\n\nfor (let index = 0; index < itens_selected.length; index++) {\n    const item = itens_selected[index];\n\n    const topic = `\n        DELETE FROM device_ir WHERE id = ${item.id};\n    `;\n\n    outputMsgs.push({ topic });\n    \n}\n\n\n\nreturn [outputMsgs];\n\n\n\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":500,"wires":[["48205a01dc4967b3"]]},{"id":"7be670abe43899c1","type":"comment","z":"e9473a462f630fe6","name":"Busca Dispositivo e Apagar","info":"","x":230,"y":340,"wires":[]},{"id":"9b280fa0add5aded","type":"comment","z":"e9473a462f630fe6","name":"Criar Dispositivo IR","info":"","x":190,"y":60,"wires":[]},{"id":"2006f8b63661eb40","type":"comment","z":"e9473a462f630fe6","name":"Criar Dispositivo pelo Banco de Dados","info":"","x":250,"y":640,"wires":[]},{"id":"705552c85e399704","type":"inject","z":"e9473a462f630fe6","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"600","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":230,"y":700,"wires":[["2b71609b5eb0af6d"]]},{"id":"2b71609b5eb0af6d","type":"function","z":"e9473a462f630fe6","name":"function 75","func":"\nconst topic = `SELECT * FROM device_ir;`;\nmsg.topic = topic;\nreturn msg\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":700,"wires":[["0082d2bba548ab2f"]]},{"id":"eebf29794b5c2e44","type":"function","z":"e9473a462f630fe6","name":"function 76","func":"const devices = msg.payload;\n\nlet outputMsgs = [];\n\nfor (let index = 0; index < devices.length; index++) {\n\n    const device = devices[index];\n\n    outputMsgs.push({ device });\n    \n}\n\n\n\nreturn [outputMsgs];\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":730,"y":700,"wires":[["cd14a3c05a9d24db"]]},{"id":"cd14a3c05a9d24db","type":"function","z":"e9473a462f630fe6","name":"function 77","func":"const device =  msg.device;\n\nconst client_id  = \"200001\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\n\nif(device.type ==  \"TV\"){\n\n  const unique_id = device.unique_id;\n  const name = device.name;\n\n\n  const topic = `homeassistant/switch/${unique_id}/config`;\n  const payload = \n  `\n{\n  \"name\": \"${name}\",\n  \"device_class\": \"switch\",\n  \"command_topic\": \"ad/${unique_id}/infrared\",\n  \"state_topic\": \"ad/${unique_id}/infrared\",\n  \"unique_id\": \"${unique_id}\",\n  \"icon\": \"mdi:remote\",\n  \"device\": {\n    \"identifiers\": [\n      \"${unique_id}\"\n    ],\n    \"name\": \"${unique_id}\",\n    \"manufacturer\": \"AutoDomo\",\n    \"model\": \"1.1\"\n  }\n}\n  `\n  msg.topic = topic;\n  msg.payload = JSON.parse(payload);\n  return msg;\n\n}else if(device.type ==  \"AC_S\"){\n\n  const unique_id = device.unique_id;\n  const name = device.name;\n  const ac_min_temp = device.ac_min_temp;\n  const ac_max_temp = device.ac_max_temp;\n\n  const topic = `homeassistant/climate/${unique_id}/config`;\n  const payload = \n  `\n    {\n      \"name\": \"${name}\",\n      \"unique_id\": \"${unique_id}\",\n      \"modes\": [\n        \"off\",\n        \"cool\"\n      ],\n      \"swing_modes\": [\n        \"on\"\n      ],\n      \"fan_modes\": [\n        \"high\"\n      ],\n      \"preset_modes\": [\n        \"activity\"\n      ],\n      \"min_temp\": ${ac_min_temp},\n      \"max_temp\": ${ac_max_temp},\n      \"power_command_topic\": \"ad/ar/power/${unique_id}\",\n      \"mode_command_topic\": \"ad/ar/mode/${unique_id}\",\n      \"preset_mode_command_topic\": \"ad/ar/presetmode/${unique_id}\",\n      \"temperature_command_topic\": \"ad/ar/temperature/${unique_id}\",\n      \"fan_mode_command_topic\": \"ad/ar/fan/${unique_id}\",\n      \"swing_mode_command_topic\": \"ad/ar/swing/${unique_id}\",\n      \"icon\": \"mdi:air-conditioner\",\n      \"device\": {\n        \"identifiers\": [\n          \"${unique_id}\"\n        ],\n        \"name\": \"${unique_id}\",\n        \"manufacturer\": \"AutoDomo\",\n        \"model\": \"1.1\"\n      }\n    }\n  `\n  msg.topic = topic;\n  msg.payload = JSON.parse(payload);\n  return msg;\n}else if(device.type ==  \"AC_E\"){\n\n  const unique_id = device.unique_id;\n  const name = device.name;\n  const ac_min_temp = device.ac_min_temp;\n  const ac_max_temp = device.ac_max_temp;\n  const ac_modes =        device.ac_modes.replace(/'/g, '\"');\n  const ac_swing_modes =  device.ac_swing_modes.replace(/'/g, '\"');\n  const ac_fan_modes =    device.ac_fan_modes.replace(/'/g, '\"');\n  const ac_preset_modes = device.ac_preset_modes.replace(/'/g, '\"');\n\n  const topic = `homeassistant/climate/${unique_id}/config`;\n  const payload = \n  `\n    {\n      \"name\": \"${name}\",\n      \"unique_id\": \"${unique_id}\",\n      \"modes\": ${ac_modes},\n      \"swing_modes\": ${ac_swing_modes},\n      \"fan_modes\": ${ac_fan_modes},\n      \"preset_modes\": ${ac_preset_modes},\n      \"min_temp\": ${ac_min_temp},\n      \"max_temp\": ${ac_max_temp},\n      \"power_command_topic\": \"ad/ar/power/${unique_id}\",\n      \"mode_command_topic\": \"ad/ar/mode/${unique_id}\",\n      \"preset_mode_command_topic\": \"ad/ar/presetmode/${unique_id}\",\n      \"temperature_command_topic\": \"ad/ar/temperature/${unique_id}\",\n      \"fan_mode_command_topic\": \"ad/ar/fan/${unique_id}\",\n      \"swing_mode_command_topic\": \"ad/ar/swing/${unique_id}\",\n      \"icon\": \"mdi:air-conditioner\",\n      \"device\": {\n        \"identifiers\": [\n          \"${unique_id}\"\n        ],\n        \"name\": \"${unique_id}\",\n        \"manufacturer\": \"AutoDomo\",\n        \"model\": \"1.1\"\n      }\n    }\n  `\n  msg.topic = topic;\n  const  payload_temp = JSON.parse(payload);\n  payload_temp.modes.push(\"off\");\n  msg.payload = payload_temp;\n  return msg;\n}\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":700,"wires":[["26a0ea2956770da9"]]},{"id":"84d53af9ccd634ac","type":"function","z":"e9473a462f630fe6","name":"function 78","func":"const itens_selected = flow.get(\"itens_selected\") || [];\n\nlet outputMsgs = [];\n\nfor (let index = 0; index < itens_selected.length; index++) {\n    const item = itens_selected[index];\n\n    const topic = `\n        SELECT * FROM device_ir WHERE id = ${item.id};\n    `;\n\n    outputMsgs.push({ topic });\n    \n}\n\n\n\nreturn [outputMsgs];\n\n\n\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":500,"wires":[["65786e388d099b50"]]},{"id":"205a09764bb6bf07","type":"function","z":"e9473a462f630fe6","name":"function 79","func":"const devices = msg.payload;\nconst hash_ad = global.get(\"hash_ad\");\n\nconst client_id  = \"200001\";\nconst command = \"__publish\";\nconst brokerId = client_id;\n\nlet outputMsgs = [];\n\nfor (let index = 0; index < devices.length; index++) {\n\n    const device = devices[index];\n    const unique_id = device.unique_id;\n    const name = device.name;\n    let topic = `homeassistant/switch/${unique_id}/config`;\n    const payload = \"\";\n    const formattedName = name.replace(/ /g, \"_\").toLowerCase();\n    let tipo = \"\";\n    let codigo_device_adomo = \"\";\n    \n\n    if(device.type == \"TV\"){\n        tipo = \"switch\";\n        topic = `homeassistant/${tipo}/${unique_id}/config`;\n        codigo_device_adomo = `${tipo}_${unique_id}_${formattedName}`;\n    }else if(device.type == \"AC_E\"){\n        tipo = \"climate\";\n        topic = `homeassistant/${tipo}/${unique_id}/config`;\n        codigo_device_adomo = `${tipo}_${unique_id}_${formattedName}`;\n    }if(device.type == \"AC_S\"){\n        tipo = \"climate\";\n        topic = `homeassistant/${tipo}/${unique_id}/config`;\n        codigo_device_adomo = `${tipo}_${unique_id}_${formattedName}`;\n    }\n\n    \n    const childpath = \"/lais/\" + hash_ad + \"/device/\" + codigo_device_adomo;\n\n    outputMsgs.push({ topic, payload, childpath, command, brokerId });\n\n}\n\n\n\nreturn [outputMsgs];\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":540,"wires":[["02b3ca7f8462ad15","26a0ea2956770da9"]]},{"id":"02b3ca7f8462ad15","type":"firebase modify","z":"e9473a462f630fe6","name":"Remove Device","firebaseconfig":"ec3b45f2cddba51a","childpath":"msg.childpath","method":"remove","value":"msg.payload","priority":"msg.priority","x":1340,"y":580,"wires":[[]]},{"id":"455efab338eb7a08","type":"ui-text-input","z":"e9473a462f630fe6","group":"7866a0a062b724fe","name":"Item Buscar","label":"Código Dispositivo/Blaster","order":1,"width":0,"height":0,"topic":"topic","topicType":"msg","mode":"text","delay":300,"passthru":true,"sendOnDelay":false,"sendOnBlur":true,"sendOnEnter":true,"className":"","x":190,"y":380,"wires":[["591bb0b1a4af74dd"]]},{"id":"6188feb409ee4abb","type":"ui-button","z":"e9473a462f630fe6","group":"7866a0a062b724fe","name":"","label":"Buscar","order":2,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":180,"y":420,"wires":[["96349ae727229b37"]]},{"id":"285b5b8dcfcc7c16","type":"ui-button","z":"e9473a462f630fe6","group":"7866a0a062b724fe","name":"","label":"Apagar","order":4,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":180,"y":500,"wires":[["84d53af9ccd634ac"]]},{"id":"251e1f1f6b6b9de5","type":"ui-text","z":"e9473a462f630fe6","group":"da680eea7fc73142","order":1,"width":0,"height":0,"name":"Adicionar TV (Midia)","label":"Adicionar TV (Midia)","format":"{{msg.payload}}","layout":"row-center","style":true,"font":"","fontSize":"25","color":"#002aff","className":"","x":200,"y":100,"wires":[]},{"id":"1ae8b7bd982025cd","type":"ui-text","z":"e9473a462f630fe6","group":"fd9db4515147f459","order":1,"width":0,"height":0,"name":"Adicionar Ar Condicionado","label":"Adicionar Ar Condicionado","format":"{{msg.payload}}","layout":"row-center","style":true,"font":"","fontSize":"25","color":"#002aff","className":"","x":220,"y":200,"wires":[]},{"id":"d054889cfd187c3d","type":"ui-table","z":"e9473a462f630fe6","group":"7866a0a062b724fe","name":"Infrared List","label":"text","order":3,"width":0,"height":0,"maxrows":"15","passthru":false,"autocols":true,"selectionType":"checkbox","columns":[],"x":1530,"y":420,"wires":[["b175352a79035d33"]]},{"id":"165de1d51b27fbc1","type":"ui-template","z":"e9473a462f630fe6","group":"fd9db4515147f459","page":"","ui":"","name":"","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <v-sheet class=\"mx-auto\" width=\"300\">\n    <v-form @submit.prevent=\"submitForm\">\n      <v-text-field\n        v-model=\"nomedispositivo\"\n        :rules=\"firstNameRules\"\n        label=\"Nome Dispositivo\"\n      ></v-text-field>\n\n      <v-text-field\n        v-model=\"tempmin\"\n        :rules=\"tempminRules\"\n        label=\"Temperatura Mínima\"\n      ></v-text-field>\n\n      <v-text-field\n        v-model=\"tempmax\"\n        :rules=\"tempmaxRules\"\n        label=\"Temperatura Máxima\"\n      ></v-text-field>\n\n        <v-radio-group v-model=\"tipo_ar\" >\n          <v-radio label=\"Modo Simplificado\" value=\"AC_S\"></v-radio>\n          <v-radio label=\"Modo Extendido\" value=\"AC_E\"></v-radio>\n        </v-radio-group>\n\n      <v-select v-model=\"ac_mode\" clearable chips label=\"Modos do Acondicionado\" :items=\"['cool', 'fan_only']\" multiple variant=\"solo-inverted\">\n      </v-select>\n\n      <v-select v-model=\"swing_modes\" clearable chips label=\"Swing Modes\" :items=\"['on', 'off']\" multiple variant=\"solo-inverted\"></v-select>\n\n      <v-select v-model=\"fan_modes\" clearable chips label=\"Fan Modes\" :items=\"['high', 'medium', 'low']\" multiple variant=\"solo-inverted\">\n      </v-select>\n\n      <v-select v-model=\"preset_modes\" clearable chips label=\"Preset Modes\" :items=\"['eco', 'sleep', 'activity']\" multiple variant=\"solo-inverted\">\n      </v-select>\n\n      <v-btn class=\"mt-2\" type=\"submit\" block :disabled=\"!formIsValid\">Criar Dispositvo</v-btn>\n\n      <p v-if=\"dispositivoCriado\" class=\"success-message\">Dispositivo Criado com sucesso!</p>\n    </v-form>\n  </v-sheet>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      nomedispositivo: '',\n      firstNameRules: [\n        value => !!value || 'Coloque pelo menos 3 caracteres.'\n      ],\n      tempmax: '',\n      tempmaxRules: [\n        value => /^\\d+$/.test(value) || 'Temperatura Máxima deve conter apenas números.'\n      ],\n      tempmin: '',\n      tempminRules: [\n        value => /^\\d+$/.test(value) || 'Temperatura Mínima deve conter apenas números.'\n      ],\n      ac_mode : [],\n      swing_modes : [],\n      fan_modes : [],\n      preset_modes : [],\n      dispositivoCriado: false,\n      tipo_ar : \"AC_S\",\n    };\n  },\n\n  computed: {\n    formIsValid() {\n      return this.firstNameRules.every(rule => rule(this.nomedispositivo)) &&\n             this.tempmaxRules.every(rule => rule(this.tempmax)) &&\n             this.tempminRules.every(rule => rule(this.tempmin));\n    }\n  },\n\n  methods: {\n    submitForm() {\n      if (!this.formIsValid) {\n        // Se o formulário não for válido, não faz nada\n        return;\n      }\n\n      const payload = {\n        nomedispositivo: this.nomedispositivo,\n        tempmax: this.tempmax,\n        tempmin: this.tempmin,\n        ac_mode: this.ac_mode,\n        swing_modes: this.swing_modes,\n        fan_modes: this.fan_modes,\n        preset_modes: this.preset_modes,\n        tipo_ar: this.tipo_ar,\n      };\n      this.send({ payload });\n\n      // Define dispositivoCriado como true para exibir a mensagem\n      this.dispositivoCriado = true;\n    },\n  },\n};\n</script>\n\n<style>\n.success-message {\n  color: green;\n  margin-top: 10px;\n}\n</style>\n","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":160,"y":240,"wires":[["ba035b910f67514d"]]},{"id":"1122b2d91d6db399","type":"ui-template","z":"e9473a462f630fe6","group":"da680eea7fc73142","page":"","ui":"","name":"","order":0,"width":0,"height":0,"head":"","format":"<template>\n  <v-sheet class=\"mx-auto\" width=\"300\">\n    <v-form @submit.prevent=\"submitForm\">\n      <v-text-field\n        v-model=\"nomedispositivo\"\n        :rules=\"firstNameRules\"\n        label=\"Nome Dispositivo\"\n      ></v-text-field>\n\n      <v-btn class=\"mt-2\" type=\"submit\" block :disabled=\"!formIsValid\">Submit</v-btn>\n\n      <p v-if=\"enviado && !erro\" class=\"success-message\">Dispositivo Criado com sucesso!</p>\n    </v-form>\n  </v-sheet>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      nomedispositivo: '',\n      enviado: false,\n      erro: false,\n      firstNameRules: [\n        value => !!value || 'Coloque pelo menos 3 caracteres.'\n      ]\n    };\n  },\n\n  computed: {\n    formIsValid() {\n      return this.firstNameRules.every(rule => rule(this.nomedispositivo)) || !this.nomedispositivo;\n    }\n  },\n\n  methods: {\n    submitForm() {\n      if (!this.formIsValid) {\n        // Se o formulário não for válido, define erro como true e não faz nada\n        this.erro = true;\n        return;\n      }\n\n      const payload = {\n        nomedispositivo: this.nomedispositivo,\n      };\n      this.send({ payload });\n\n      // Define enviado como true para exibir a mensagem\n      this.enviado = true;\n      this.erro = false;\n    },\n  },\n};\n</script>\n\n<style>\n.success-message {\n  color: green;\n  margin-top: 10px;\n}\n</style>\n","storeOutMessages":true,"passthru":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":160,"y":140,"wires":[["0075d9d59919f855"]]},{"id":"8212c9d02528cf9d","type":"sqlite","z":"e9473a462f630fe6","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":700,"y":200,"wires":[["2b71609b5eb0af6d"]]},{"id":"c0ac81927c6d0608","type":"sqlite","z":"e9473a462f630fe6","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":1380,"y":420,"wires":[["d054889cfd187c3d"]]},{"id":"48205a01dc4967b3","type":"sqlite","z":"e9473a462f630fe6","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":1080,"y":500,"wires":[["96349ae727229b37"]]},{"id":"0082d2bba548ab2f","type":"sqlite","z":"e9473a462f630fe6","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":580,"y":700,"wires":[["eebf29794b5c2e44"]]},{"id":"65786e388d099b50","type":"sqlite","z":"e9473a462f630fe6","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":620,"y":500,"wires":[["1e1f94ae2c36fd43","205a09764bb6bf07"]]},{"id":"26a0ea2956770da9","type":"mqtt one","z":"e9473a462f630fe6","name":"","x":1190,"y":660,"wires":[[]]},{"id":"c0c19d5152d4741d","type":"ui-button","z":"e9473a462f630fe6","group":"29636dffefc2a433","name":"","label":"Remover Todos os Dispositivos do APP AutoDomo","order":2,"width":0,"height":0,"passthru":false,"tooltip":"","color":"","bgcolor":"","className":"","icon":"mdi:cellphone-remove","iconPosition":"left","payload":"","payloadType":"str","topic":"topic","topicType":"msg","x":810,"y":960,"wires":[["25bc46f092b78f74"]]},{"id":"25bc46f092b78f74","type":"function","z":"e9473a462f630fe6","name":"Fuction Remover","func":"const hash_ad = global.get(\"hash_ad\");\n\nif (hash_ad.length >= 32){\n\n    msg.childpath = \"/lais/\" + hash_ad + \"/device/\";\n    return msg;\n\n}\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1050,"y":780,"wires":[["5c372385fd962133"]]},{"id":"5c372385fd962133","type":"firebase modify","z":"e9473a462f630fe6","name":"Remover Device","firebaseconfig":"ec3b45f2cddba51a","childpath":"msg.childpath","method":"remove","value":"msg.payload","priority":"msg.priority","x":1240,"y":780,"wires":[[]]},{"id":"e1c75e65974d490f","type":"inject","z":"e9473a462f630fe6","name":"Limpar","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":800,"wires":[["25bc46f092b78f74"]]},{"id":"eb3beb4941f3d27a","type":"comment","z":"e9473a462f630fe6","name":"Remove Dispositivos","info":"Remove os Dispositivos do aplicativos.\n\nOs dispositvos não seram apagados no Home Assistant.\n\nQuandos o Status de casa dispositivo alterar esse novamente irar aparecer no APP AutoDomo","x":200,"y":760,"wires":[]},{"id":"bf98898e9fe58685","type":"server-events","z":"b3e227b45cdb32ea","name":"TodosEventos","server":"7da491b7.5ebd7","version":3,"exposeAsEntityConfig":"","eventType":"","eventData":"","waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"entity_id","propertyType":"msg","value":"$outputData(\"eventData\").event.service_data.entity_id","valueType":"str"}],"x":90,"y":60,"wires":[["19b0a43e964f231e"]]},{"id":"19b0a43e964f231e","type":"function","z":"b3e227b45cdb32ea","name":"TrataObjeto","func":"const haCtx = global.get(\"homeassistant\");\n\nconst configCtx = haCtx.homeAssistant;\nconst jsonObject = msg.payload;\nconst event_type = msg.event_type;\nconst hash_ad = global.get(\"hash_ad\");\nmsg.hash_ad = hash_ad\n\n\n\nif(event_type == \"state_changed\"){\n\n    const newStateObject = jsonObject.event.new_state;\n    msg.newStateObject = newStateObject;\n    const entity_id =   newStateObject.entity_id;\n   const type_component  = entity_id.split(\".\");\n    msg.entity_id = entity_id;\n    msg.time_fired = jsonObject.time_fired;\n    const state = jsonObject?.event?.new_state?.state;\n    msg.state = state;\n    const attributes = jsonObject?.event?.new_state?.attributes;\n    const entity = configCtx?.states[entity_id];\n    msg.displayName = entity?.attributes?.friendly_name || \"none\";\n    msg.icon = entity?.attributes?.icon || \"none\";\n    msg.device_class = entity?.attributes?.device_class || jsonObject?.event?.new_state?.attributes?.device_class || \"none\";;\n    msg.brightness = entity?.attributes?.brightness || \"none\";\n    msg.rgb_color = entity?.attributes?.rgb_color || \"none\";\n    msg.position_cover = jsonObject?.event?.new_state?.attributes?.current_position || \"none\";\n    msg.state_cover = jsonObject?.event?.new_state?.state || \"none\";\n    msg.attributes = attributes;\n    msg.payload = entity_id;\n    msg.entity = entity;\n    msg.jsonObject = jsonObject;\n    return [msg, null, null, null, null];\n    \n\n} else if (event_type == \"call_service\"){\n\n    const domain = jsonObject.event.domain;\n    const service = jsonObject.event.service;\n    const entity_id = jsonObject.event.service_data.entity_id;\n    msg.payload = entity_id;\n    msg.jsonObject = jsonObject;\n\n    \n\n    if (domain == \"light1\" || domain == \"switch1\"){\n\n        const entity = configCtx.states[entity_id];\n        msg.displayName = entity.attributes.friendly_name;\n        msg.icon = entity.attributes.icon || \"none\";\n        msg.device_class = entity.attributes.device_class || \"none\";\n        msg.brightness = entity.attributes.brightness || \"none\";\n        msg.rgb_color = entity.attributes.rgb_color || \"none\";\n\n        if (service == \"turn_on\"){\n            msg.entity_id = entity_id;\n            msg.state = \"on\"\n\n        }else if(service == \"turn_off\"){\n            msg.entity_id = entity_id;\n            msg.state = \"off\"\n\n        }  \n        return [msg, null, null, null];\n    } else if (domain == \"scene\"){\n        const entity = configCtx.states[entity_id];\n        msg.displayName = entity.attributes.friendly_name;\n        msg.icon = entity.attributes.icon || \"none\";\n        msg.device_class = entity.attributes.device_class || \"none\";\n        msg.brightness = entity.attributes.brightness || \"none\";\n        msg.rgb_color = entity.attributes.rgb_color || \"none\";\n\n        if (service == \"turn_on\") {\n            msg.entity_id = entity_id;\n            msg.state = \"on\"\n\n        } else if (service == \"turn_off\") {\n            msg.entity_id = entity_id;\n            msg.state = \"off\"\n\n        }\n        return [msg, null, null, null];\n    } else if (domain == \"notify\") {\n\n        let outputMsgs = [];\n        msg.url = \"https://api.autodomo.com.br/sendnotif\";\n\n\n\n        const service_data = jsonObject.event.service_data;\n\n        const target = service_data?.target ? service_data?.target : undefined;\n        const message = service_data?.message ? service_data?.message : \"\";\n        const title = service_data?.title ? service_data?.title : \"\";\n\n\n        if (target) {\n            const url = \"https://api.autodomo.com.br/sendnotif\";\n            const emailsArray = target.split(\",\").map(email => email.trim());\n            const length = emailsArray.length;\n\n            for (var i = 0; i < length; i++) {\n                const payload = {\n                    \"email\": emailsArray[i],\n                    \"titulo_msg\": title,\n                    \"body_msg\": message\n                }\n                outputMsgs.push({ payload, url });\n\n            }\n\n            return [null, null, null, null, outputMsgs];\n\n        } else {\n\n            msg.url = \"https://api.autodomo.com.br/sendnotifbytoken\";\n            msg.payload = {\n                \"token\": hash_ad,\n                \"titulo_msg\": title,\n                \"body_msg\": message\n            }\n\n            return [null, null, null, null, msg];\n        }\n\n    }\n\n}else if (event_type == \"entity_registry_updated\"){\n\n    const entity_id = jsonObject.event.entity_id;\n    const changes = jsonObject.event.changes;\n    let delete_dev = false;\n\n\n\n    if (\"disabled_by\" in changes) {\n\n        if (changes.disabled_by == null){\n            delete_dev = true;\n        }\n        \n\n    } else if (\"hidden_by\" in changes) {\n\n        if (changes.hidden_by == null) {\n            delete_dev = true;\n        }\n        \n    }\n\n    msg.entity_id = entity_id;\n    msg.delete_dev = delete_dev;\n\n    return [null, msg, null, null];\n\n    \n} else if (event_type == \"entity_registry_updated1\") {\n\n    return [null, null, msg, null];\n} else{\n\n    return [null, null, null, msg];\n}\n\nfunction tratar_climate(jsonObject){\n\n    const entity_id = jsonObject?.event?.new_state?.entity_id || \"none\";\n    msg.entity = entity_id;\n    const attributes = jsonObject?.event?.new_state?.attributes;\n    msg.attributes = attributes;\n    const newStateObject = jsonObject?.event?.new_state;\n    const entity = configCtx?.states[entity_id];\n    msg.displayName = entity?.attributes?.friendly_name || \"none\";\n    msg.icon = entity?.attributes?.icon || \"none\";\n    msg.brightness = \"none\";\n    msg.rgb_color = \"none\";\n\n    return msg\n\n}\n\n","outputs":5,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":60,"wires":[["80de422199b7175b"],["c67ee2d52aef42c6"],[],[],["05d05e642af09f03"]]},{"id":"3c4bdd15e13dd0cb","type":"api-render-template","z":"b3e227b45cdb32ea","name":"","server":"7da491b7.5ebd7","version":0,"template":"","resultsLocation":"payload","resultsLocationType":"msg","templateLocation":"template","templateLocationType":"msg","x":740,"y":40,"wires":[["765f8c844a8d9dba"]]},{"id":"80de422199b7175b","type":"change","z":"b3e227b45cdb32ea","name":"","rules":[{"t":"set","p":"template","pt":"msg","to":"{\"area_id\":\"{{area_id('xxxxx')}}\"}","tot":"str"},{"t":"change","p":"template","pt":"msg","from":"xxxxx","fromt":"str","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":40,"wires":[["3c4bdd15e13dd0cb"]]},{"id":"151e4204f170fe01","type":"firebase modify","z":"b3e227b45cdb32ea","name":"AD FireBase_Set","firebaseconfig":"ec3b45f2cddba51a","childpath":"msg.childpath","method":"set","value":"msg.payload","priority":"msg.priority","x":1830,"y":40,"wires":[[]]},{"id":"7bc42f0b960ccb1e","type":"function","z":"b3e227b45cdb32ea","name":"Tratar Tipo","func":"const entity_id = msg.entity_id;\n\nconst partes = entity_id.split(\".\");\n\nconst brightness =  msg.brightness;\nconst rgb_color  =  msg.rgb_color;\n\nconst tipo_home_assistant = partes[0];\nlet codigo_device_adomo = partes[1];\n\nmsg.tipo_home_assistant = tipo_home_assistant;\n\nconst device_class = msg.device_class;\n\nvar doisPrimeirosDigitos = codigo_device_adomo.substring(0, 2); // Obtém os dois primeiros dígitos\nconst tipo_device = Number(doisPrimeirosDigitos.substr(0, 2))\nvar regex = /^(0[1-9]|[1-3][0-9]|40)$/; // Expressão regular para números entre 01 e 40\n\n\nif (codigo_device_adomo.length == 24 && !Number.isNaN(tipo_device) && tipo_device > 0 ){\n\n}else{\n\n    if (regex.test(doisPrimeirosDigitos) && codigo_device_adomo.substring(2, 3) == \"_\"){\n\n        codigo_device_adomo = determina_codigo_randon(tipo_home_assistant, msg.md5, doisPrimeirosDigitos); \n    }else{\n        codigo_device_adomo = determina_codigo_randon(tipo_home_assistant, msg.md5, \"00\"); \n    }\n\n    \n\n    \n}\n\n\n\nconst tipo_device_adomo_str = codigo_device_adomo.substring(0, 2);\n\n\nif(codigo_device_adomo.length == 24){\n    const tipo_device_adomo = parseInt(codigo_device_adomo.substring(0, 2));\n    msg.ambiente = JSON.parse(msg.payload).area_id;\n    msg.comando =  \"\";\n    msg.codigo_device_adomo = codigo_device_adomo;\n    msg.tipo_device_adomo = tipo_device_adomo;\n    msg.unit_of_measurement = \"\";\n\n    if (tipo_home_assistant == \"sensor\") {\n        msg.unit_of_measurement = msg.attributes.unit_of_measurement;\n\n    }\n    return msg;\n\n}\n\n\nfunction determina_codigo_randon(tipo_home_assistant, md5, tipo_device) {\n\n    let _tipo_device = tipo_device;\n    let codigo_device_adomo = \"\";\n\n    if(tipo_device == \"00\"){\n\n        if (tipo_home_assistant == \"switch\" || tipo_home_assistant == \"light\") {\n\n            if (tipo_home_assistant == \"light\" && brightness != \"none\" && rgb_color != \"none\"){\n                _tipo_device = \"05\";\n            }else if (tipo_home_assistant == \"light\" && brightness != \"none\" && rgb_color == \"none\") {\n                _tipo_device = \"24\";\n            }else{\n                _tipo_device = \"01\";\n            }\n            \n\n        } else if (tipo_home_assistant == \"sensor\") {\n            if(device_class == \"temperature\"){\n                _tipo_device = \"03\";\n            }else if(device_class == \"motion\"){\n                 _tipo_device = \"13\";\n            }else if(device_class == \"humidity\"){\n                 _tipo_device = \"02\";\n            }else if(device_class == \"illuminance\"){\n                 _tipo_device = \"04\";\n            }else if (device_class == \"data_rate\") {\n                _tipo_device = \"19\";\n            }else if (device_class == \"battery\") {\n                _tipo_device = \"16\";\n            } else{\n                _tipo_device = \"31\";\n            }\n           \n        } else if (tipo_home_assistant == \"input_boolean\") {\n        \n            _tipo_device = \"33\";\n\n        } else if (tipo_home_assistant == \"binary_sensor\") {\n\n            if (device_class == \"door\") {\n                _tipo_device = \"17\";\n            } else {\n                _tipo_device = \"32\";\n            }\n\n        } else if (tipo_home_assistant == \"scene\") {\n\n            _tipo_device = \"34\";\n\n        }else if (tipo_home_assistant == \"climate\") {\n\n            _tipo_device = \"10\";\n\n        } else if (tipo_home_assistant == \"cover\") {\n\n            if (device_class == \"garage\") {\n                _tipo_device = \"20\";\n            } else if (device_class == \"blind\") {\n                _tipo_device = \"09\";\n            } else if (device_class == \"curtain\") {\n                _tipo_device = \"09\";\n            } else if (device_class == \"gate\") {\n                _tipo_device = \"20\";\n            } else {\n                _tipo_device = \"20\";\n            }\n\n\n        } else{\n            return \"00\";\n        }\n\n        \n\n    }\n\n\n    codigo_device_adomo = _tipo_device + md5.substring(0, 22);\n    return codigo_device_adomo;\n}\n\n\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1010,"y":40,"wires":[["eb21e0fb01774115"]]},{"id":"eb21e0fb01774115","type":"function","z":"b3e227b45cdb32ea","name":"Tratar Payload","func":"const ambiente = msg.ambiente;\nconst Descricao = msg.displayName;\nconst tipo_device_adomo = msg.tipo_device_adomo;\nconst icon = msg.icon || \"none\";\nconst state = msg.state;\nconst device_class = msg.device_class || \"none\";\n\nconst ir_simplified_ad = global.get(\"ir_simplified_ad\");\n\nconst position_cover = msg?.position_cover || \"none\";\nconst state_cover = msg?.state_cover || \"none\";\n\nlet attributes = \"none\";\nvar msg1 = null;\nvar msg2 = null;\nvar msg3 = null;\n\n\nconst client_id  = \"200001\";\n\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\nmsg3 = Object.assign({}, msg);\n\nmsg3.command = \"__publish\";\nmsg3.brokerId = client_id;\n\nif (msg.tipo_home_assistant == \"climate\"){\n      msg1 = Object.assign({}, msg);\n      msg2 = Object.assign({}, msg);\n      const init_topic = \"ad/ar/infrared\";\n      attributes  = msg.attributes;\n      const entity_id = msg.entity_id;\n      const partes = entity_id.split(\".\");\n      const codigo_device = partes[1];\n\n\n\n      msg1.command = \"__publish\";\n      msg1.brokerId = client_id;\n\n      msg2.command = \"__publish\";\n      msg3.brokerId = client_id;\n\n\n\n      let button_tag  = \"off\";\n\n      const { preset_mode, fan_mode, temperature, swing_mode } = attributes;  \n      if (state == \"off\"){\n            button_tag = `${state}`\n      }else{\n           if(ir_simplified_ad){\n                  button_tag = `on_${temperature}`\n            }else{\n                  button_tag = `${state}_${temperature}_${preset_mode}_${fan_mode}_${swing_mode}`\n            }\n      }\n      \n      msg1.payload = button_tag;\n      msg1.topic = init_topic;\n\n      const init_topic_sql = `select * from infrared where tagcode = \"${button_tag}\" and device = \"${codigo_device.split(\"_\").slice(0, 2).join(\"_\")}\";`;\n\n\n      msg.topic = init_topic_sql;\n      msg2.topic = init_topic_sql;\n\n}\n\n\nmsg.payload = {\n        \"Descricao\": Descricao,\n        \"ambiente\": ambiente,\n        \"nome_ambiente\": ambiente,\n        \"tipo_geral\": tipo_device_adomo,\n        \"setPubTopic0\" : msg.entity_id,\n        \"setSubTopic2\" : state,\n        \"setSubTopic3\" : state,\n        \"username_iphone\": msg.codigo_device_adomo || \"none\", \n        \"unit_of_measurement\": msg.unit_of_measurement || \"none\",\n        \"entity_id\" : msg.entity_id,\n        \"brightness\" : msg.brightness || \"none\",\n        \"rgb_color\": msg.rgb_color || \"none\",\n        icon,\n        device_class,\n        position_cover,\n        state_cover,\n        attributes,\n        time_fired : msg.time_fired\n}\n\nmsg3.payload = {\n        \"Descricao\": Descricao,\n        \"tipo_geral\": tipo_device_adomo,\n        \"setSubTopic2\" : state,\n        \"setSubTopic3\" : state,\n        \"username_iphone\": msg.codigo_device_adomo || \"none\",\n        \"entity_id\" : msg.entity_id,\n        \"brightness\" : msg.brightness || \"none\",\n        \"rgb_color\": msg.rgb_color || \"none\",\n        device_class,\n        position_cover,\n        state_cover,\n        attributes,\n        hash_ad : msg.hash_ad\n}\n\nmsg.childpath = \"/lais/\" + msg.hash_ad + \"/device/\" + msg.entity_id.replace(/\\./g, \"_\");\nreturn [msg, msg2, msg1, msg3];","outputs":4,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1200,"y":40,"wires":[["151e4204f170fe01"],["2605f278c4667b78"],["bbeccc5e49bd0a79"],["958373e501e7b183"]]},{"id":"3d6de673a3ebf97e","type":"inject","z":"b3e227b45cdb32ea","name":"init","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":90,"y":300,"wires":[["e25adeb624563c54"]]},{"id":"bd39f0474c60bd52","type":"firebase modify","z":"b3e227b45cdb32ea","name":"Remove Device","firebaseconfig":"ec3b45f2cddba51a","childpath":"msg.childpath","method":"remove","value":"msg.payload","priority":"msg.priority","x":760,"y":80,"wires":[[]]},{"id":"fd70cf950364800c","type":"firebase.on","z":"b3e227b45cdb32ea","name":"GetComando","firebaseconfig":"ec3b45f2cddba51a","childpath":"msg.childpath","atStart":true,"eventType":"value","queries":[],"x":610,"y":340,"wires":[["6fb82ed82b30265a"]]},{"id":"e25adeb624563c54","type":"function","z":"b3e227b45cdb32ea","name":"Escuta no Publica","func":"const hash_ad = global.get(\"hash_ad\");\nmsg.hash_ad = hash_ad\n\n\n\n\nmsg.childpath = \"/lais/\" + hash_ad + \"/publica\";\n\nvar msg1 = Object.assign({}, msg);\n\nmsg1.childpath = \"/lais/\" + hash_ad + \"/mobile\";\n\nreturn [ msg,   msg1];","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":340,"wires":[["fd70cf950364800c"],[]]},{"id":"29c905df9313c82c","type":"function","z":"b3e227b45cdb32ea","name":"Set Topico","func":"const hash_ad = global.get(\"hash_ad\");\n\nconst tempo = msg.payload;\nmsg.payload = {\n        \"topico\" : \"0.0\",\n}\n\n\n\nmsg.childpath = \"lais/\" + hash_ad + \"/publica/\";\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1650,"y":280,"wires":[["151e4204f170fe01"]]},{"id":"37e64b4fd648e4b3","type":"http request","z":"b3e227b45cdb32ea","name":"Req HTTP","method":"POST","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[{"keyType":"Content-Type","keyValue":"","valueType":"other","valueValue":"application/json"},{"keyType":"Authorization","keyValue":"","valueType":"msg","valueValue":"authorization"}],"x":1410,"y":320,"wires":[["29c905df9313c82c"]]},{"id":"c67ee2d52aef42c6","type":"function","z":"b3e227b45cdb32ea","name":"Tratar Remover","func":"const entity_id = msg.entity_id;\nconst delete_dev = msg.delete_dev;\n\n\nif (delete_dev){\n\n    const partes = entity_id.split(\".\");\n    const tipo_home_assistant = partes[0];\n    const codigo_device_adomo = partes[1];\n\n\n    msg.childpath = \"/lais/\" + msg.hash_ad + \"/device/\" + codigo_device_adomo;\n    return msg;\n\n}\n\n\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":80,"wires":[["bd39f0474c60bd52"]]},{"id":"765f8c844a8d9dba","type":"md5","z":"b3e227b45cdb32ea","name":"MD5","fieldToHash":"entity_id","fieldTypeToHash":"msg","hashField":"md5","hashFieldType":"msg","x":870,"y":40,"wires":[["7bc42f0b960ccb1e"]]},{"id":"0206744222d4b499","type":"function","z":"b3e227b45cdb32ea","name":"SendCodeIR","func":"const payload = msg.payload;\n\n\n\n\nconst topic = `cmnd/${msg.payload[0].ir_id}/irsend`\nconst code = msg.payload[0].code\n\nconst client_id  = \"200001\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\nmsg.topic = topic;\n\n    let codigo_json = code;\n\n    try {\n        codigo_json = JSON.parse(code);\n    } catch (error) {\n        codigo_json = code;\n    };\n\n    msg.payload = codigo_json;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1650,"y":380,"wires":[["29c905df9313c82c","bbeccc5e49bd0a79"]]},{"id":"958373e501e7b183","type":"http request","z":"b3e227b45cdb32ea","name":"ApiAutodomo","method":"POST","ret":"txt","paytoqs":"ignore","url":"https://api.autodomo.com.br/updatestatus","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[{"keyType":"Content-Type","keyValue":"","valueType":"other","valueValue":"application/json"},{"keyType":"Authorization","keyValue":"","valueType":"msg","valueValue":"authorization"}],"x":2040,"y":180,"wires":[[]]},{"id":"6fb82ed82b30265a","type":"function","z":"b3e227b45cdb32ea","name":"Tratar Comandos Mobile","func":"const token_ad = global.get(\"token_api_ad\");\nconst ir_simplified_ad = global.get(\"ir_simplified_ad\");\nmsg.token_ad = token_ad\n\nconst client_id  = \"200001\";\n\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\nconst  { \n    IpServidor, \n    aleatorio, \n    comando, \n    email, \n    emailVerified,\n    imei,\n    md5,\n    topico,\n    type\n    }  = msg.payload;\n\n    msg.carga = msg.payload;\n\n\nconst partes = topico.split(\".\");\nlet tipo_home_assistant = partes[0];\nconst codigo_device_adomo = partes[1];\n\n\nif(type == \"tv\"){\n    tipo_home_assistant = \"tv\";\n}else if (type == \"climate\"){\n    tipo_home_assistant = \"climate\";\n}else if (type == \"media\"){\n    tipo_home_assistant = \"media\";\n}\n\n\nconst payload = {\n    \"entity_id\": topico\n}\n\n\nmsg.authorization = `Bearer ${token_ad}`;\n\n\nif(tipo_home_assistant == \"switch\"){\n\n    if (comando == \"0\" || comando == \"p0\"){\n\n        msg.url = \"http://localhost:8123/api/services/switch/turn_off\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    } else if (comando == \"1\" || comando == \"p1\"){\n\n        msg.url = \"http://localhost:8123/api/services/switch/turn_on\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n    }\n\n} if (tipo_home_assistant == \"cover\") {\n\n\n\n    if (comando.substring(0) == \"P100\"){\n        msg.url = \"http://localhost:8123/api/services/cover/open_cover\";\n        const payload = {\"entity_id\": topico,}\n        msg.payload = payload;\n        return [msg, null, null, null];\n    }else if (comando.substring(0) == \"P000\"){\n        msg.url = \"http://localhost:8123/api/services/cover/close_cover\";\n        const payload = {\"entity_id\": topico,}\n        msg.payload = payload;\n        return [msg, null, null, null];\n    }else if (comando.substring(0) == \"P101\"){\n        msg.url = \"http://localhost:8123/api/services/cover/stop_cover\";\n        const payload = {\"entity_id\": topico,}\n        msg.payload = payload;\n        return [msg, null, null, null];\n    }else if (comando.substring(0) == \"P102\"){\n        msg.url = \"http://localhost:8123/api/services/cover/toggle\";\n        const payload = {\"entity_id\": topico,}\n        msg.payload = payload;\n        return [msg, null, null, null];\n     }\n     //else if (comando.substring(0, 1) == \"p\" || comando.substring(0, 1) == \"P\"){\n    //     msg.topic = `ad/command/dft/${codigo_device_adomo}`\n    //     msg.payload = comando\n    //     return [null, msg];\n    // }\n\n\n    msg.url = \"http://localhost:8123/api/services/cover/set_cover_position\";\n\n    const payload = {\n        \"entity_id\": topico,\n        \"position\": comando,\n    }\n\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n\n} else if (tipo_home_assistant == \"light\") {\n\n    if (comando == \"0\" || comando == \"p0\") {\n\n        msg.url = \"http://localhost:8123/api/services/light/turn_off\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    } else if (comando == \"1\" || comando == \"p1\") {\n\n        msg.url = \"http://localhost:8123/api/services/light/turn_on\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    } else if (comando.substring(0, 4) == \"rgba\") {\n\n        msg.url = \"http://localhost:8123/api/services/light/turn_on\";\n\n        let rgbaArray = comando.match(/\\d+(\\.\\d+)?/g);\n\n            let red = rgbaArray[0];\n            let green = rgbaArray[1];\n            let blue = rgbaArray[2];\n            let alpha = rgbaArray[3];\n\n\n        const payload = {\n            \"entity_id\": topico,\n            \"rgb_color\": [red, green, blue],\n            \"brightness\": alpha * 255,\n        }\n\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    } else if (comando.substring(0, 4) == \"bght\") {\n\n        msg.url = \"http://localhost:8123/api/services/light/turn_on\";\n\n        const brightness = comando.substring(4);\n\n        const payload = {\n            \"entity_id\": topico,\n            \"brightness\": brightness,\n        }\n\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    }\n\n} else if (tipo_home_assistant == \"input_boolean\") {\n\n    if (comando == \"0\") {\n\n        msg.url = \"http://localhost:8123/api/services/input_boolean/turn_off\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    } else if (comando == \"1\") {\n\n        msg.url = \"http://localhost:8123/api/services/input_boolean/turn_on\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    }\n\n} else if (tipo_home_assistant == \"scene\") {\n\n    if (comando == \"1\") { // Cena so pode comando 1\n\n        msg.url = \"http://localhost:8123/api/services/scene/turn_on\";\n        msg.payload = payload;\n        return [msg, null, null, null];\n\n    }\n\n}else if (tipo_home_assistant == \"climate\") {\n\n    let msg1 = Object.assign({}, msg);\n    let msg2 = Object.assign({}, msg);\n\n    msg1.command = \"__publish\";\n    msg1.brokerId = client_id;\n\n    msg2.command = \"__publish\";\n    msg2.brokerId = client_id;\n\n    const init_topic_mqtt = \"ad/ar/infrared\";\n    const init_topic_mqtt2 = `ad/${codigo_device_adomo}/infrared`;\n    \n    let button_tag  = \"off\";\n\n    const { modeAir, preset_mode, fan_mode, temperature, swing_mode } = comando;  \n    if (modeAir == \"off\"){\n        button_tag = `${modeAir}`\n    }else{\n        if(ir_simplified_ad){\n            button_tag = `on_${temperature}`\n        }else{\n            button_tag = `${modeAir}_${temperature}_${preset_mode}_${fan_mode}_${swing_mode}`\n        }  \n    }\n    \n    const init_topic_sql = `select * from infrared where tagcode = \"${button_tag}\" and device = \"${codigo_device_adomo.split(\"_\").slice(0, 2).join(\"_\")}\";`;\n\n\n    msg.topic = init_topic_sql;\n\n    msg1.payload = button_tag\n    msg1.topic = init_topic_mqtt;\n\n    msg2.payload = button_tag\n    msg2.topic = init_topic_mqtt2;\n\n    return [null, msg, msg1, null, msg2];\n}else if (tipo_home_assistant == \"tv\") {\n\n    let msg1 = Object.assign({}, msg);\n    let msg2 = Object.assign({}, msg);\n\n    msg1.command = \"__publish\";\n    msg1.brokerId = client_id;\n\n    msg2.command = \"__publish\";\n    msg2.brokerId = client_id;\n\n    const init_topic_mqtt = \"ad/tv/infrared\";\n    const init_topic_mqtt2 = `ad/${codigo_device_adomo}/infrared`;\n    \n    const init_topic_sql = `select * from infrared where tagcode = \"${comando}\" and device = \"${codigo_device_adomo.split(\"_\").slice(0, 2).join(\"_\")}\";`;\n\n    msg.topic = init_topic_sql;\n\n    msg1.payload = comando\n    msg1.topic = init_topic_mqtt;\n\n    msg2.payload = comando\n    msg2.topic = init_topic_mqtt2;\n\n    return [null, msg, msg1, null, msg2];\n\n}else if (tipo_home_assistant == \"media\") {\n\n    let msg1 = Object.assign({}, msg);\n    let msg2 = Object.assign({}, msg);\n\n    msg1.command = \"__publish\";\n    msg1.brokerId = client_id;\n\n    msg2.command = \"__publish\";\n    msg2.brokerId = client_id;\n    \n    const init_topic_mqtt = \"ad/md/infrared\";\n    const init_topic_mqtt2 = `ad/${codigo_device_adomo}/infrared`;\n    \n\n    const init_topic_sql = `select * from infrared where tagcode = \"${comando}\" and device = \"${codigo_device_adomo.split(\"_\").slice(0, 2).join(\"_\")}\";`;\n\n    msg.topic = init_topic_sql;\n\n    msg1.payload = comando\n    msg1.topic = init_topic_mqtt;\n\n    msg2.payload = comando\n    msg2.topic = init_topic_mqtt2;\n\n    return [null, msg, msg1, null, msg2];\n}else if (tipo_home_assistant == \"new_device\") {\n\n    msg.topic = msg.payload.topic;\n\n    msg.payload = comando;\n\n    return [null, null, null, msg];\n\n}\n\n\n\n\n\n","outputs":5,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1030,"y":340,"wires":[["37e64b4fd648e4b3"],["2605f278c4667b78"],["bbeccc5e49bd0a79"],["bbeccc5e49bd0a79"],["bbeccc5e49bd0a79"]]},{"id":"2cf91209de2d2843","type":"server-events","z":"b3e227b45cdb32ea","name":"HA Startup","server":"7da491b7.5ebd7","version":3,"exposeAsEntityConfig":"","eventType":"home_assistant_client","eventData":"","waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":80,"y":380,"wires":[["e25adeb624563c54"]]},{"id":"05d05e642af09f03","type":"http request","z":"b3e227b45cdb32ea","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":580,"y":160,"wires":[[]]},{"id":"2605f278c4667b78","type":"sqlite","z":"b3e227b45cdb32ea","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":1440,"y":380,"wires":[["0206744222d4b499"]]},{"id":"bbeccc5e49bd0a79","type":"mqtt one","z":"b3e227b45cdb32ea","name":"","x":2070,"y":320,"wires":[["1adc1ac250b732f2"]]},{"id":"1adc1ac250b732f2","type":"debug","z":"b3e227b45cdb32ea","name":"debug 32","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2200,"y":440,"wires":[]},{"id":"bad60d78b0c07488","type":"function","z":"6a1bf79e0039b1d9","name":"TrataComandoParaMesh","func":"const topico = msg.topic;\nconst carga = msg.payload;\nconst partes_topico  = topico.split(\"/\"); \n\nconst client_id  = \"100001\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\nmsg.topic = \"/adomo/meshs/admPub\";\n\nif (partes_topico[2] == \"rgb\") {\n    const rgb = carga.split(\",\");\n //   msg.payload = \"{\\\"t\\\":\\\"rl\\\",\\\"id\\\":\\\"\" + partes_topico[3] + \"\\\",\\\"v\\\":\\\"r\" + rgb[0] + \"\" + rgb[1] + \"\" + rgb[2] + \"\\\"}\";\n    msg.payload = JSON.parse(`{\"t\":\"rl\",\"id\":\"${partes_topico[3]}\",\"v\":\"r${rgb[0]}${rgb[1]}${rgb[2]}\"}`);\n}else if(partes_topico[2] == \"bgh\"){\n    //msg.payload = \"{\\\"t\\\":\\\"rl\\\",\\\"id\\\":\\\"\" + partes_topico[3] + \"\\\",\\\"v\\\":\\\"\" + carga + \"\\\"}\";\n    msg.payload = JSON.parse(`{\"t\":\"rl\",\"id\":\"${partes_topico[3]}\",\"v\":\"${carga}\"}`);\n}else if(partes_topico[2] == \"dft\") {\n   // msg.payload = \"{\\\"t\\\":\\\"rl\\\",\\\"id\\\":\\\"\" + partes_topico[3] + \"\\\",\\\"v\\\":\\\"\" + carga + \"\\\"}\";\n    msg.payload = JSON.parse(`{\"t\":\"rl\",\"id\":\"${partes_topico[3]}\",\"v\":\"${carga}\"}`);\n}\n\n\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1070,"y":140,"wires":[["9dd70ca025ddfdd4"]]},{"id":"79435c5799402593","type":"function","z":"6a1bf79e0039b1d9","name":"TrataComandoParaHA","func":"const topico = msg.topic\nconst cargajson = msg.payload\nconst tipo = cargajson.t;\n\n\nconst client_id  = \"100002\";\nmsg.command = \"__publish\";\nmsg.brokerId = client_id;\n\nif (tipo == \"st\") {\n    const id = cargajson.id;\n    const status = cargajson.s;\n        msg.topic = \"ad/state/dft/\" + id;\n        msg.payload = Number(status);\n        return msg;\n} else if (tipo == \"sw\") {\n    const id = cargajson.id;\n    const status = cargajson.s;\n    msg.topic = \"ad/state/sw/\" + id;\n    msg.payload = status;\n    return msg;\n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1060,"y":200,"wires":[["e8eab70ee258eb01","b50b81d85987c728","a661cdb9b3f36aeb"]]},{"id":"0a37398b2d849271","type":"inject","z":"6a1bf79e0039b1d9","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":200,"y":180,"wires":[["c6f08ec1935473ae","e6b43b453cd7acf9"]]},{"id":"ad6bffc72c56481d","type":"function","z":"6a1bf79e0039b1d9","name":"function 88","func":"\nconst topic=  msg.topic;\n\nif (topic == \"/adomo/meshp/admPub\"){\n    if (msg.brokerId != \"100002\") return;\n    return [null, msg];\n}else if(topic.startsWith(\"ad/command/\")){\n    if (msg.brokerId != \"100001\") return;\n    return [msg, null];\n}\n\n","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":180,"wires":[["bad60d78b0c07488"],["79435c5799402593"]]},{"id":"6b6a257b1b2c7b42","type":"mqtt one","z":"6a1bf79e0039b1d9","name":"","x":610,"y":160,"wires":[["ad6bffc72c56481d"]]},{"id":"bc85c6aba4b364ba","type":"mqtt one","z":"6a1bf79e0039b1d9","name":"","x":610,"y":200,"wires":[["ad6bffc72c56481d"]]},{"id":"c6f08ec1935473ae","type":"function","z":"6a1bf79e0039b1d9","name":"function 91","func":"// const client_id = Date.now() + 1000;\nconst client_id  = \"100001\";\n\n//global.set(\"client_id\", client_id + 1000);\nconst host = global.get(\"mqtt_broker_ad\") || \"\";\nconst port = global.get(\"mqtt_porta\") || \"\";\nconst username = global.get(\"mqtt_usuario_ad\") || \"\";\nconst password = global.get(\"mqtt_senha_ad\") || \"\";\n\nmsg.command = \"__add_broker\";\nmsg.brokerId = client_id,\nmsg.payload = {\n    subscriptions: [\"ad/command/#\"],\n      options: {\n          protocol:  'mqtt',\n          port,\n          host,\n          \"clientId\" : client_id,\n          username,\n          password\n      }\n  }\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":140,"wires":[["6b6a257b1b2c7b42"]]},{"id":"e6b43b453cd7acf9","type":"function","z":"6a1bf79e0039b1d9","name":"function 92","func":"//const client_id = Date.now();\nconst client_id  = \"100002\";\n\n//global.set(\"client_id\", client_id);\nconst host = global.get(\"mqtt_broker_ad\") || \"\";\nconst port = global.get(\"mqtt_porta\") || \"\";\nconst username = global.get(\"mqtt_usuario_ad\") || \"\";\nconst password = global.get(\"mqtt_senha_ad\") || \"\";\n\nmsg.command = \"__add_broker\";\nmsg.brokerId = client_id,\nmsg.payload = {\n    subscriptions: [\"/adomo/meshp/admPub\"],\n      options: {\n          protocol:  'mqtt',\n          port,\n          host,\n          \"clientId\" : client_id,\n          username,\n          clean : true,\n          password\n      }\n  }\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":430,"y":220,"wires":[["bc85c6aba4b364ba"]]},{"id":"9dd70ca025ddfdd4","type":"mqtt one","z":"6a1bf79e0039b1d9","name":"","x":1310,"y":160,"wires":[[]]},{"id":"e8eab70ee258eb01","type":"mqtt one","z":"6a1bf79e0039b1d9","name":"","x":1310,"y":220,"wires":[[]]},{"id":"1a499a19db4afe4d","type":"function","z":"6a1bf79e0039b1d9","name":"function 99","func":"const modificado_mqtt_2 = global.get(\"modificado_mqtt_2\") || \"0\";\n\nif (modificado_mqtt_2 == \"1\"){\n    global.set(\"modificado_mqtt_2\", \"0\");\n    return msg;\n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":360,"wires":[["c6f08ec1935473ae","e6b43b453cd7acf9"]]},{"id":"abe2f1f1d369a187","type":"inject","z":"6a1bf79e0039b1d9","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":360,"wires":[["1a499a19db4afe4d"]]},{"id":"b50b81d85987c728","type":"debug","z":"6a1bf79e0039b1d9","name":"debug 35","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1260,"y":320,"wires":[]},{"id":"a661cdb9b3f36aeb","type":"debug","z":"6a1bf79e0039b1d9","name":"debug 36","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","targetType":"msg","statusVal":"","statusType":"auto","x":1260,"y":380,"wires":[]},{"id":"6609f62d2f586127","type":"file in","z":"45bd2399da8caa2f","name":"Read secrets.yaml","filename":"/homeassistant/secrets.yaml","filenameType":"str","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":470,"y":100,"wires":[["de456075b28a0236"]]},{"id":"de456075b28a0236","type":"yaml","z":"45bd2399da8caa2f","property":"payload","name":"Parse yaml","x":670,"y":100,"wires":[[]]},{"id":"5eb265b9cb61cb7d","type":"function","z":"45bd2399da8caa2f","name":"Set global config vars","func":"for (let [key, value] of Object.entries(msg.payload[0])) {\n  global.set(key,value);\n}\n\nconst qrcodeinput = `${msg.payload[0].name_ad}--${msg.payload[0].hash_ad}-${msg.payload[0].ip_ad}-true`\nmsg.qrcodeinput = qrcodeinput;\n\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":880,"y":160,"wires":[["238771a4792a5838"]]},{"id":"278fb2ccc75db945","type":"comment","z":"45bd2399da8caa2f","name":"Run on HA start","info":"","x":120,"y":40,"wires":[]},{"id":"6bf4f029f94fea7f","type":"comment","z":"45bd2399da8caa2f","name":"Set global config vars with secrets.yaml entries","info":"https://bonani.tech/make-a-node-red-flow-run-on-home-assistant-start/","x":420,"y":20,"wires":[]},{"id":"2c92a2e7e59a9ac8","type":"inject","z":"45bd2399da8caa2f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":220,"wires":[["78d096d6658d014a"]]},{"id":"02446ba2611f5289","type":"server-events","z":"45bd2399da8caa2f","name":"HA Startup","server":"7da491b7.5ebd7","version":3,"exposeAsEntityConfig":"","eventType":"home_assistant_client","eventData":"","waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":80,"y":100,"wires":[["84b224aede879550","c2a85587ec840d46"]]},{"id":"84b224aede879550","type":"switch","z":"45bd2399da8caa2f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"running","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":100,"wires":[["78d096d6658d014a"]]},{"id":"c2a85587ec840d46","type":"function","z":"45bd2399da8caa2f","name":"function 26","func":"msg.topic = \"CREATE TABLE IF NOT EXISTS infrared (id INTEGER PRIMARY KEY,device TEXT, ir_id TEXT, tagcode TEXT, code TEXT, marca TEXT, modelo TEXT, tipo TEXT);\"\n\n\nvar msg1 = Object.assign({}, msg);\nvar msg2 = Object.assign({}, msg);\nvar msg3 = Object.assign({}, msg);\n\nmsg1.topic = \"CREATE TABLE IF NOT EXISTS config (id INTEGER PRIMARY KEY, hash_ad TEXT, ip_ad TEXT, name_ad TEXT, token_api_ad TEXT, ir_simplified_ad INTEGER);\";\n\nmsg2.topic = \"CREATE TABLE IF NOT EXISTS mqttconfig (id INTEGER PRIMARY KEY, mqtt_broker_ad TEXT, mqtt_porta TEXT, mqtt_usuario_ad TEXT, mqtt_senha_ad TEXT, mqtt_senha_ad_cripto TEXT);\";\n\nmsg3.topic = `\n    CREATE TABLE IF NOT EXISTS device_ir (\n        id INTEGER PRIMARY KEY,\n        type TEXT,\n        name TEXT,\n        unique_id TEXT,\n        ac_modes TEXT,\n        ac_swing_modes TEXT,\n        ac_fan_modes TEXT,\n        ac_preset_modes TEXT,\n        ac_min_temp INTEGER,\n        ac_max_temp INTEGER\n    );\n`;\n\nlet outputMsgs = [];\n\noutputMsgs.push(msg);\noutputMsgs.push(msg1);\noutputMsgs.push(msg2);\noutputMsgs.push(msg3);\n\nreturn [outputMsgs];","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":40,"wires":[["d2088500c2fc041c"]]},{"id":"d2088500c2fc041c","type":"sqlite","z":"45bd2399da8caa2f","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":1040,"y":40,"wires":[[]]},{"id":"78d096d6658d014a","type":"function","z":"45bd2399da8caa2f","name":"function 82","func":"\n\nvar msg1 = Object.assign({}, msg);\n\nmsg.topic = \"SELECT * FROM config;\";\n\nmsg1.topic = \"SELECT * FROM mqttconfig;\"\n\nreturn [msg, msg1];","outputs":2,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":220,"wires":[["0632d66758f33af5"],["24f08983e9505e44"]]},{"id":"0632d66758f33af5","type":"sqlite","z":"45bd2399da8caa2f","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":680,"y":160,"wires":[["5eb265b9cb61cb7d"]]},{"id":"24f08983e9505e44","type":"sqlite","z":"45bd2399da8caa2f","mydb":"9a93dc0a78c5b00b","sqlquery":"msg.topic","sql":"","name":"autodomo","x":680,"y":280,"wires":[["a1646a02060018a8"]]},{"id":"238771a4792a5838","type":"qrcode-generator","z":"45bd2399da8caa2f","name":"","qrtype":"text2qr","text2qrText":"","ssid":"","hiddenssid":false,"wifitype":"","phonenum":"","smsphonenum":"","smstext":"","mailto":"","mailsubject":"","mailbody":"","latitude":"","longitude":"","colorlight":"#ffffff","colordark":"#000000","printstatus":false,"x":1290,"y":160,"wires":[["98d6e99bdec28ca5","fbdf06b5dda876c3"]]},{"id":"98d6e99bdec28ca5","type":"image","z":"45bd2399da8caa2f","name":"Preview QRCode","width":"320","data":"payload","dataType":"msg","thumbnail":false,"active":false,"pass":false,"outputs":0,"x":1510,"y":160,"wires":[]},{"id":"5417583d0e017538","type":"comment","z":"45bd2399da8caa2f","name":"Gerar QRCode","info":"Gera QrCode para ser lido pelo APP AutoDomo.\n\nNão esqueçer de atualizar as informaçãoes no arquivo secrets.yaml","x":1400,"y":80,"wires":[]},{"id":"fbdf06b5dda876c3","type":"function","z":"45bd2399da8caa2f","name":"function 67","func":"const qrcode_ad = msg.payload;\nglobal.set(\"qrcode_ad\", qrcode_ad);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1510,"y":120,"wires":[[]]},{"id":"a1646a02060018a8","type":"function","z":"45bd2399da8caa2f","name":"Set global config vars","func":"for (let [key, value] of Object.entries(msg.payload[0])) {\n  global.set(key,value);\n}\n\n\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":880,"y":280,"wires":[["31d1b9fcee0bf43a","1a41a13f500b5311"]]},{"id":"fe4847f03160ec8d","type":"comment","z":"45bd2399da8caa2f","name":"MQTT INIT","info":"","x":1180,"y":240,"wires":[]},{"id":"0d6f149c7708d4ed","type":"function","z":"45bd2399da8caa2f","name":"function 89","func":"const client_id = Date.now();\n\nglobal.set(\"client_id\", client_id);\nconst host = global.get(\"mqtt_broker_ad\") || \"\";\nconst port = global.get(\"mqtt_porta\") || \"\";\nconst username = global.get(\"mqtt_usuario_ad\") || \"\";\nconst password = global.get(\"mqtt_senha_ad\");''\n\nmsg.command = \"__add_broker\";\nmsg.brokerId = client_id,\nmsg.payload = {\n    subscriptions: [],\n      options: {\n          protocol:  'mqtt',\n          port,\n          host,\n          username,\n          password\n      }\n  }\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1070,"y":420,"wires":[[]]},{"id":"c349a14bb520187d","type":"mqtt one","z":"45bd2399da8caa2f","name":"","x":1490,"y":280,"wires":[[]]},{"id":"31d1b9fcee0bf43a","type":"function","z":"45bd2399da8caa2f","name":"function 96","func":"// const client_id = Date.now() + 1000;\nconst client_id  = \"200001\";\n\n//global.set(\"client_id\", client_id + 1000);\nconst host = global.get(\"mqtt_broker_ad\") || \"\";\nconst port = global.get(\"mqtt_porta\") || \"\";\nconst username = global.get(\"mqtt_usuario_ad\") || \"\";\nconst password = global.get(\"mqtt_senha_ad\") || \"\";\n\nmsg.command = \"__add_broker\";\nmsg.brokerId = client_id,\nmsg.payload = {\n    subscriptions: [\"ad/lixo/200001\"],\n      options: {\n          protocol:  'mqtt',\n          port,\n          host,\n          \"clientId\" : client_id,\n          username,\n          password\n      }\n  }\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1310,"y":280,"wires":[["c349a14bb520187d"]]},{"id":"43df519250375ac9","type":"mqtt one","z":"45bd2399da8caa2f","name":"","x":1490,"y":360,"wires":[[]]},{"id":"1a41a13f500b5311","type":"function","z":"45bd2399da8caa2f","name":"function 97","func":"// const client_id = Date.now() + 1000;\nconst client_id  = \"300001\";\n\n//global.set(\"client_id\", client_id + 1000);\nconst host = global.get(\"mqtt_broker_ad\") || \"\";\nconst port = global.get(\"mqtt_porta\") || \"\";\nconst username = global.get(\"mqtt_usuario_ad\") || \"\";\nconst password = global.get(\"mqtt_senha_ad\") || \"\";\n\nmsg.command = \"__add_broker\";\nmsg.brokerId = client_id,\nmsg.payload = {\n    subscriptions: [\"tele/+/RESULT\",  \"ad/+/infrared\"],\n      options: {\n          protocol:  'mqtt',\n          port,\n          host,\n          \"clientId\" : client_id,\n          username,\n          password\n      }\n  }\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1310,"y":360,"wires":[["43df519250375ac9"]]},{"id":"9ca49f0df0e2abed","type":"inject","z":"45bd2399da8caa2f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":380,"wires":[["ebb4bbdc4e32bd32"]]},{"id":"ebb4bbdc4e32bd32","type":"function","z":"45bd2399da8caa2f","name":"function 98","func":"const modificado_mqtt_1 = global.get(\"modificado_mqtt_1\") || \"0\";\n\nif (modificado_mqtt_1 == \"1\"){\n    global.set(\"modificado_mqtt_1\", \"0\");\n    return msg;\n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":380,"wires":[["78d096d6658d014a","1247167a26a3efa1"]]},{"id":"1247167a26a3efa1","type":"debug","z":"45bd2399da8caa2f","name":"debug 34","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":660,"y":380,"wires":[]}]